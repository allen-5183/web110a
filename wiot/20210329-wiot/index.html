<!DOCTYPE HTML>
<html lang="zh-CN">



<head>
    <meta charset="utf-8">
    <meta name="keywords" content="wiot, 個人博客 呆呆 學習 Allen">
    <meta name="description" content="網頁技術| 物聯網應用 | AI 智能">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>wiot | 呆呆-博客</title>
    <link rel="icon" type="image/gif" href="/medias/diamond.gif">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<style type="text/css" lang="css">
    #loading-container{
        position: fixed;
        top: 0;
        left: 0;
        min-height: 100vh;
        width: 100vw;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #FFF;
        text-align: center;
        /* loader页面消失采用渐隐的方式*/
        -webkit-transition: opacity 1s ease;
        -moz-transition: opacity 1s ease;
        -o-transition: opacity 1s ease;
        transition: opacity 1s ease;
    }
    .loading-image{
        width: 120px;
        height: 50px;
        transform: translate(-50%);
    }

    .loading-image div:nth-child(2) {
        -webkit-animation: pacman-balls 1s linear 0s infinite;
        animation: pacman-balls 1s linear 0s infinite
    }

    .loading-image div:nth-child(3) {
        -webkit-animation: pacman-balls 1s linear .33s infinite;
        animation: pacman-balls 1s linear .33s infinite
    }

    .loading-image div:nth-child(4) {
        -webkit-animation: pacman-balls 1s linear .66s infinite;
        animation: pacman-balls 1s linear .66s infinite
    }

    .loading-image div:nth-child(5) {
        -webkit-animation: pacman-balls 1s linear .99s infinite;
        animation: pacman-balls 1s linear .99s infinite
    }

   .loading-image div:first-of-type {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
        animation: rotate_pacman_half_up .5s 0s infinite;
    }
    .loading-image div:nth-child(2) {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
        animation: rotate_pacman_half_down .5s 0s infinite;
        margin-top: -50px;
    }
    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: 
rotate(270deg)}}

    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: 
rotate(270deg)}}

    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: 
rotate(90deg)}}

    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: 
rotate(90deg)}}

    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}


    .loading-image div:nth-child(3),
    .loading-image div:nth-child(4),
    .loading-image div:nth-child(5),
    .loading-image div:nth-child(6){
        background-color: #49b1f5;
        width: 15px;
        height: 15px;
        border-radius: 100%;
        margin: 2px;
        width: 10px;
        height: 10px;
        position: absolute;
        transform: translateY(-6.25px);
        top: 25px;
        left: 100px;
    }
    .loading-text{
        margin-bottom: 20vh;
        text-align: center;
        color: #2c3e50;
        font-size: 2rem;
        box-sizing: border-box;
        padding: 0 10px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @media only screen and (max-width: 500px) {
         .loading-text{
            font-size: 1.5rem;
         }
    }
    .fadeout {
        opacity: 0;
        filter: alpha(opacity=0);
    }
    /* logo出现动画 */
    @-webkit-keyframes 
fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
 </style>
 <script>
(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },1000); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()
 </script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="呆呆-博客" type="application/atom+xml">
</head>


<script src="/js/instant.page.js" type="module"></script>

<script type="text/javascript">
var OriginTitile=document.title,st;
document.addEventListener("visibilitychange",function(){document.hidden?(document.title="看不見我🙈~看不見我🙈~",clearTimeout(st)):(document.title=" 被發現了～",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script>

<script type="text/javascript">
  //只在桌上出版網頁啟用特效
  var windowWidth = $(window).width();
  if (windowWidth > 768) {
    //雪花特效
    document.write('<script type="text/javascript" src="/js/xuehuapiaoluo.js"><\/script>');
    //櫻花特效
    //document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
    //無效 
    //document.write('<script type="text/javascript" src="/js/xingxing.js"><\/script>');
    //滑鼠點擊文字特效。(❤富強❤,❤民主❤,❤文明❤,❤和諧❤,❤自由❤,❤平等❤,❤公正❤,❤法治❤,❤愛國❤,❤敬業❤,❤誠信❤,❤友善❤);)
    //document.write('<script type="text/javascript" src="/js/wenzi.js"><\/script>');

  }
</script>



 <div id="loading-container">
     <p class="loading-text">努力加載中 . . . </p> 
     <div class="loading-image">
         <div></div>
         <div></div>
         <div></div>
         <div></div> 
         <div></div>
     </div>
 </div><body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/loading.gif" data-original="/medias/diamond.gif" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">呆呆-博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首頁</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>關於</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情連結</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-meh-rolling-eyes" style="zoom: 0.6;"></i>
      
      <span>收納櫃</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/tags">
          
          <i class="fas fa-tags" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>標籤</span>
        </a>
      </li>
      
      <li>
        <a href="/categories">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>分類</span>
        </a>
      </li>
      
      <li>
        <a href="/archives">
          
          <i class="fas fa-archive" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>歸檔</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>媒體</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/movie">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>電影</span>
        </a>
      </li>
      
      <li>
        <a href="/video">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>視頻</span>
        </a>
      </li>
      
      <li>
        <a href="/galleries">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>相冊</span>
        </a>
      </li>
      
      <li>
        <a href="/books">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>書籍</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/loading.gif" data-original="/medias/diamond.gif" class="logo-img circle responsive-img">
        
        <div class="logo-name">呆呆-博客</div>
        <div class="logo-desc">
            
            網頁技術| 物聯網應用 | AI 智能
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首頁
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			關於
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情連結
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-meh-rolling-eyes"></i>
			
			收納櫃
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/tags " style="margin-left:75px">
				  
				   <i class="fa fas fa-tags" style="position: absolute;left:50px" ></i>
			      
		          <span>標籤</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>分類</span>
                  </a>
                </li>
              
                <li>

                  <a href="/archives " style="margin-left:75px">
				  
				   <i class="fa fas fa-archive" style="position: absolute;left:50px" ></i>
			      
		          <span>歸檔</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			媒體
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/movie " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>電影</span>
                  </a>
                </li>
              
                <li>

                  <a href="/video " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>視頻</span>
                  </a>
                </li>
              
                <li>

                  <a href="/galleries " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>相冊</span>
                  </a>
                </li>
              
                <li>

                  <a href="/books " style="margin-left:75px">
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>書籍</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '5616b70ad3dda5e6509877de73ccd63eddb79073a6749dcbd1ec23f1bbb0856a';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('請輸入訪問本文章的密碼')).toString(CryptoJS.enc.Hex)) {
                alert('密碼錯誤，將返回主頁！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title"></h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章內容詳情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/iot/">
                                <span class="chip bg-color">iot</span>
                            </a>
                        
                            <a href="/tags/wiot/">
                                <span class="chip bg-color">wiot</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/wiot/" class="post-category">
                                wiot
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>發佈日期:&nbsp;&nbsp;
                    2021-03-28
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-硬體建置"><a href="#1-硬體建置" class="headerlink" title="1. 硬體建置"></a>1. 硬體建置</h2><h3 id="1-1-配線圖"><a href="#1-1-配線圖" class="headerlink" title="1.1 配線圖"></a>1.1 配線圖</h3><ul>
<li><p>樹莓派腳位圖</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602102127.png" class="nofancybox img-center">
</li>
<li><p>樹莓派與其他裝置連接腳位圖</p>
<table>
<thead>
<tr>
<th align="left">PI3 B+ 腳位</th>
<th align="left">PI3 B+ 功能描述</th>
<th align="left">其他裝置腳位</th>
</tr>
</thead>
<tbody><tr>
<td align="left">PI3 B+ 18</td>
<td align="left">GPIO 24</td>
<td align="left">Buzzer I/O</td>
</tr>
<tr>
<td align="left">PI3 B+ 2</td>
<td align="left">5V Power</td>
<td align="left">Buzzer VCC、SG 900 VCC(紅)</td>
</tr>
<tr>
<td align="left">PI3 B+ 6</td>
<td align="left">GND</td>
<td align="left">Buzzer GND、SG 900 GND(褐)</td>
</tr>
<tr>
<td align="left">PI3 B+ 11</td>
<td align="left">GPIO 17</td>
<td align="left">DHT 11 Out</td>
</tr>
<tr>
<td align="left">PI3 B+ 4</td>
<td align="left">5V Power</td>
<td align="left">DHT +</td>
</tr>
<tr>
<td align="left">PI3 B+ 20</td>
<td align="left">GND</td>
<td align="left">DHT -</td>
</tr>
<tr>
<td align="left">PI3 B+ 12</td>
<td align="left">GPIO 18 PCM_CLK</td>
<td align="left">SG 900 訊號(橘)</td>
</tr>
<tr>
<td align="left">PI3 B+ 37</td>
<td align="left">GPIO 26</td>
<td align="left">RELAY IN1</td>
</tr>
<tr>
<td align="left">PI3 B+ 13</td>
<td align="left">GPIO 27</td>
<td align="left">RELAY IN2</td>
</tr>
<tr>
<td align="left">PI3 B+ 15</td>
<td align="left">GPIO 22</td>
<td align="left">RELAY IN3</td>
</tr>
<tr>
<td align="left">PI3 B+ 16</td>
<td align="left">GPIO 23</td>
<td align="left">RELAY IN4</td>
</tr>
<tr>
<td align="left">PI3 B+ 24</td>
<td align="left">GPIO  8 SPIO_CE0_N</td>
<td align="left">RFID RC522 SDA</td>
</tr>
<tr>
<td align="left">PI3 B+ 23</td>
<td align="left">GPIO 11 SPIO_SCLK</td>
<td align="left">RFID RC522 SCK</td>
</tr>
<tr>
<td align="left">PI3 B+ 19</td>
<td align="left">GPIO 10 SPIO_MOSI</td>
<td align="left">RFID RC522 MOSI</td>
</tr>
<tr>
<td align="left">PI3 B+ 21</td>
<td align="left">GPIO  9 SPIO_MISO</td>
<td align="left">RFID RC522 MISO</td>
</tr>
<tr>
<td align="left">PI3 B+ 25</td>
<td align="left">GND</td>
<td align="left">RFID RC522 GND</td>
</tr>
<tr>
<td align="left">PI3 B+ 22</td>
<td align="left">GPIO 25</td>
<td align="left">RFID RC522 RST</td>
</tr>
<tr>
<td align="left">PI3 B+ 17</td>
<td align="left">3V3 Power</td>
<td align="left">RFID RC522 3.3V</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="1-2-SDCard-燒錄"><a href="#1-2-SDCard-燒錄" class="headerlink" title="1.2 SDCard 燒錄"></a>1.2 SDCard 燒錄</h3><ol>
<li><p>先安裝 <code>SDFormatterv4</code></p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-sd_format.png" class="nofancybox img-center">

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-sd_format-2.png" class="nofancybox  img-center">
</li>
<li><p>SD Card 寫入</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-sd_write.png" class="nofancybox  img-center">

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_sd_write-ok.png" class="nofancybox  img-center">

<blockquote>
<p>這裡使用的版本是: <code>http://blog-images.allen5183.synology.me/wiot/2018-11-13-raspbian-stretch.img</code></p>
</blockquote>
</li>
</ol>
<h3 id="1-3-網路設定參考"><a href="#1-3-網路設定參考" class="headerlink" title="1.3 網路設定參考"></a>1.3 網路設定參考</h3><ul>
<li><p>網卡IP</p>
<p>有兩處可以修正網卡設定，擇一來設定，第一種方法會優先。</p>
<ol>
<li><code>sudo nano /etc/dhcpcd.cong</code></li>
<li><code>sudo nano /etc/network/interfaces</code></li>
</ol>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">#表示使用 localhost
auto lo 
# 有網路卡 eth0，則用靜態方式設定 IP:
iface eth0 inet static
static ip_address=192.168.57.40
static routers=192.168.57.254
static domain_name_servers=8.8.8.8 168.95.1.1

# DHCP
#iface eth0 inet dhcp
# 有網路卡 eth0，則使用 dhcp 獲取 IP:
#static domain_name_servers=8.8.#8.8 168.95.1.1

# Wifi
#auto wlan0 #有 WLAN 使用 wlan0 裝置名稱
#wlan裝置可以熱拔插
#allow-hotplug wlan0
#有WLAN 網路時，使用 wpa-psk 認證方式
#iface wlan0 inet dhcp
#wpa-ssid "yvts"
#wpa-psk  "yvtsyvts"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>重新啟動</strong><br><code>sudo /etc/init.d/networking restart</code></p>
</li>
</ul>
<h2 id="2-環境設置"><a href="#2-環境設置" class="headerlink" title="2. 環境設置"></a>2. 環境設置</h2><h3 id="2-1-SSH-免密碼登入"><a href="#2-1-SSH-免密碼登入" class="headerlink" title="2.1 SSH 免密碼登入"></a>2.1 SSH 免密碼登入</h3><ol>
<li><p>使用系統管理者權限，修改檔案 <code>c:\windows\system32\drivers\etc\hosts</code></p>
<p>增加一筆資料如下:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.xxx.xxx    smarthome.edu.tw<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>測試:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> smarthome.edu.tw<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>本機端(Window)，安裝 <a target="_blank" rel="noopener" href="https://git-scm.com/downloads">Git</a></p>
</li>
<li><p>設定識別資料, 使用 <code>Git bash</code> 開啟終端機視窗後，執行如下命令:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config --global user.name  <span class="token string">"John Doe"</span>
<span class="token function">git</span> config --global user.email  johndoe@example.com

<span class="token comment">#指定編輯器</span>
<span class="token function">git</span> config --global core.editor <span class="token string">"'C:/Program Files (x86)/Notepad++/notepad++.exe' -multiInst -nosession"</span>
<span class="token comment">#or</span>
<span class="token function">git</span> config --global core.editor <span class="token string">"'C:/tools/nano.exe' -multiInst -nosession"</span>
<span class="token function">git</span> config --list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置 <code>sshd</code> 服務，允許認證金鑰檔案:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#登入 PI</span>
<span class="token function">ssh</span> pi@smarthome.edu.tw
<span class="token comment">#修改 SSH Daemon 服務組態檔</span>
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/ssh/sshd_config
<span class="token comment"># 將最前面的註解符號 `#` 取消掉，如下</span>
  AuthorizedKeysFile      .ssh/authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>在定時備份或批次遠端處理，往往需要免密碼登入遠端主機工作。為達此目的，首先必須在 client 端產生一組 key，包含公開金鑰（Public Key）與私密金鑰（Private Key），將公鑰送到要登入的主機，相互對應做免密碼的登入。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#檢查有無私鑰與公鑰(本機端 PC)</span>
<span class="token function">ls</span> -al ~/.ssh/id_rsa.pub
<span class="token function">ls</span> -al ~/.ssh/id_rsa
<span class="token comment">#若沒有金鑰的話，key 的產生方法：</span>
ssh-keygen -t rsa -C xxx@gmail.com

Generating public/private rsa key pair.
Enter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/root/.ssh/id_rsa<span class="token punctuation">)</span>:
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>:
Enter same passphrase again:
Your identification has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.pub.
The key fingerprint is:
c3:e9:25:65:00:c8:65:cb:e8:fe:4e:7e:ce:06:a4:9d root@kvm8.deyu.wang
The key's randomart image is:
+--<span class="token punctuation">[</span> RSA <span class="token number">2048</span><span class="token punctuation">]</span>----+
<span class="token operator">|</span>   <span class="token builtin class-name">.</span> o+<span class="token punctuation">..</span>        <span class="token operator">|</span>
<span class="token operator">|</span>    o+ <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>       <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token builtin class-name">.</span> o   o      <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token builtin class-name">.</span>  <span class="token punctuation">..</span> +       <span class="token operator">|</span>
<span class="token operator">|</span>    .+ .S <span class="token builtin class-name">.</span>      <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token punctuation">..</span> E. +       <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token builtin class-name">.</span> <span class="token punctuation">..</span>.        <span class="token operator">|</span>
<span class="token operator">|</span>     + .o        <span class="token operator">|</span>
<span class="token operator">|</span>     .++o        <span class="token operator">|</span>
+-----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>將公開金鑰放到要登入的主機上，利用以下指令完成:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> pi@smarthome.edu.tw <span class="token string">'mkdir -p ~/.ssh; cat &gt;&gt; ~/.ssh/authorized_keys'</span> <span class="token operator">&lt;</span> ~/.ssh/id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>登入測試</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> pi@smarthome.edu.tw<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>特別注意目錄 .ssh 及檔案 authorized_keys 的權限，若群組或其他人的權限過大，除了安全性有問題外，也有可能因 ssh 判斷要對應的金鑰不安全，而無法對應，也就是不能免密碼登入。</p>
</blockquote>
</li>
<li><p>調整權限<br>設定 PI 上的authorized_keys 可讀、寫</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> pi@smarthome.edu.tw <span class="token string">"chmod 600 ~/.ssh/authorized_keys"</span>
<span class="token comment"># 設定 PI 上的authorized_keys 唯讀</span>
   <span class="token function">ssh</span> pi@smarthome.wda.edu.tw <span class="token string">"chmod 400 ~/.ssh/authorized_keys"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>再簡化登入程序: 本機 PC 端，加入 <code>config</code>, 簡化 <code>ssh</code> 登入指令</p>
<ul>
<li><p>在 <code>~/.ssh</code> 下新增 <code>config</code> 檔案，不需任何副檔名。</p>
</li>
<li><p>在新增的檔案裡加上你的第一個 SSH config</p>
<p><code>nano ~/.ssh/config</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Host pi                     <span class="token comment"># 用來連線的 alias 名稱</span>
HostName smarthome.edu.tw   <span class="token comment"># host domain 或 ip</span>
Port <span class="token number">22</span>                     <span class="token comment"># host 的 SSH port</span>
User pi                     <span class="token comment"># (選填)登入 SSH 的 username，</span>
                            <span class="token comment">#  只連 git 的話，可以不必要</span>
ForwardX11 <span class="token function">yes</span>              <span class="token comment"># (選填) 啟用回傳 GUI</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>測試<br><code>ssh pi</code> </p>
</li>
</ul>
</li>
<li><p>常用 SSH 指令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#基本連線</span>
<span class="token function">ssh</span> username@hostname<span class="token punctuation">[</span>ip<span class="token punctuation">]</span>   
<span class="token comment">#SSH 連線再附加其他指令</span>
<span class="token function">ssh</span> pi <span class="token function">mkdir</span> <span class="token builtin class-name">test</span>
<span class="token comment">#scp 指定 SSH name</span>
<span class="token function">scp</span> -r ./ pi:/var/www/html/project/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>本機電腦端設定:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">d:
<span class="token builtin class-name">cd</span> d:<span class="token punctuation">\</span>xampp<span class="token punctuation">\</span>htdocs

<span class="token comment">#打開現行工作目錄</span>
code <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然後在 <code>vscode</code> 視窗下建立一新目錄 <code>smarthome</code>，就可以點擊滑鼠左鍵，來執行下載樹莓派檔案。</p>
</li>
<li><p>安裝 vscode 的套件 <code>sftp</code><br>F1 或 Ctrl+Shift+P, 選擇 SFTP:Config</p>
<p>加入以下設定:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
       <span class="token builtin class-name">:</span>
   <span class="token punctuation">}</span> ,

   <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"My Server"</span>,
    <span class="token string">"host"</span><span class="token builtin class-name">:</span> <span class="token string">"smarthome.edu.tw"</span>,
    <span class="token string">"protocol"</span><span class="token builtin class-name">:</span> <span class="token string">"sftp"</span>,
    <span class="token string">"port"</span><span class="token builtin class-name">:</span> <span class="token number">22</span>,
    <span class="token string">"username"</span><span class="token builtin class-name">:</span> <span class="token string">"pi"</span>,
    <span class="token string">"privateKeyPath"</span><span class="token builtin class-name">:</span> <span class="token string">"C:/Users/allen/.ssh/id_rsa"</span>,
    <span class="token string">"remotePath"</span><span class="token builtin class-name">:</span> <span class="token string">"/home/pi/www"</span>,
    <span class="token string">"uploadOnSave"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1YhOhREq4PmGqmGdS4rLc_dzmm0w92UTs?usp=sharing/VsCode_Setting.txt">VSCode 設定檔</a></p>
</li>
</ol>
<h3 id="2-2-安裝-Apache-MySQL-PHP"><a href="#2-2-安裝-Apache-MySQL-PHP" class="headerlink" title="2.2 安裝 Apache + MySQL+ PHP"></a>2.2 安裝 <code>Apache + MySQL+ PHP</code></h3><ol>
<li><p>更新軟體套件清單<br><code>sudo apt get update y</code></p>
</li>
<li><p>更新軟體套件本身<br><code>sudo apt get upgrade y</code></p>
</li>
<li><p>重啟<br><code>reboot</code></p>
</li>
</ol>
<h4 id="2-2-1-安裝-Apache-PHP"><a href="#2-2-1-安裝-Apache-PHP" class="headerlink" title="2.2.1 安裝 Apache PHP"></a>2.2.1 安裝 Apache PHP</h4><ol>
<li><p>安裝軟體</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> get <span class="token function">install</span> apache2 y
<span class="token function">sudo</span> <span class="token function">apt</span> get <span class="token function">install</span> php y
<span class="token function">sudo</span> <span class="token function">apt</span> get <span class="token function">install</span> php mysql y
<span class="token function">sudo</span> <span class="token function">apt</span> get <span class="token function">install</span> php mbstring y
<span class="token function">sudo</span> systemctl restart apache2
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/apache2 apache2.conf <span class="token comment">## 設定文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601160012.png" width="40%" height="50%">
<br>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601160111.png" width="40%" height="50%">

<p><code>sudo nano /etc/ports.conf</code></p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601160507.png" width="60%" height="50%">

<p><strong>重啟伺服器</strong><br><code>sudo systemctl restart apache2</code></p>
</li>
<li><p>驗證 <code>apache</code> 正常運作：</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601161921.png" width="60%" height="50%">

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /var/www/html/
<span class="token function">sudo</span> <span class="token function">mv</span> index.html index1.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601162829.png" width="60%" height="50%">
</li>
<li><p>修改根目錄：   </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p /home/pi/www/web
<span class="token function">sudo</span> <span class="token function">chown</span> -R pi:www-data /home/pi/www/web
<span class="token function">chmod</span> -R <span class="token number">770</span> /home/pi/www/web
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/apache2/apache2.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601165908.png" width="50%" height="50%">

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601165936.png" width="50%" height="50%">

<p><code>sudo nano /etc/apache2/sites-enabled/000-default.conf</code></p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601163545.png" width="50%" height="50%">

<blockquote>
<p>cd  /etc/apache2/sites-available<br>  ln -s /etc/apache2/sites-enabled/000-default.conf<br>  sudo systemctl restart apache2</p>
</blockquote>
</li>
<li><p>加入虛擬新網域</p>
<ul>
<li><p>新網域名稱: <code>smarthome.edu.tw</code></p>
</li>
<li><p>建立資料夾: <code>mkdir ~/www/smarthome</code></p>
</li>
<li><p>修改現有檔案: <code>nano /etc/apache2/sites-enabled/000-default.conf</code></p>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">&lt;VirtualHost *:80&gt;
  ServerName smarthome.edu.tw
  #ServerAdmin webmaster@localhost
  DocumentRoot /home/pi/www/smarthome

  &lt;Directory /home/pi/www/smarthome&gt;
    Options indexes FollowSymLinks
    AllowOverride None
    Require all granted
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
</li>
<li><p>重啟 <code>Apache</code> 伺服器<br><code>sudo systemctl restart apache2</code></p>
</li>
<li><p>開啟 <code>PHP</code> 錯誤日誌<br><code>sudo nano /etc/php/7.0/apache2/php.ini</code></p>
 <img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601163646.png" width="50%" height="50%">

</li>
</ol>
<h4 id="2-2-2-安裝-MySQL"><a href="#2-2-2-安裝-MySQL" class="headerlink" title="2.2.2 安裝 MySQL"></a>2.2.2 安裝 MySQL</h4><ul>
<li><p>安裝<br><code>apt cache search mysql server</code><br><code>sudo apt get install mysql server</code></p>
</li>
<li><p>Setting MySQL/MariaDB root password  </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> mysql u root p
mysql<span class="token operator">&gt;</span> use mysql<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> update user <span class="token builtin class-name">set</span> <span class="token assign-left variable">plugin</span><span class="token operator">=</span><span class="token string">''</span> where u <span class="token assign-left variable">ser</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> flush privileges<span class="token punctuation">;</span>

<span class="token punctuation">(</span>刷新權限，當你直接通過 update 權限後，需要通過刷新使你的授權有效<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>
<span class="token function">sudo</span> mysql_secure_installation
<span class="token function">sudo</span> mysql u root p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601170430.png" width="50%" height="50%">

<p>[參考文獻](<a target="_blank" rel="noopener" href="https://websiteforstudents.com/mariadb">https://websiteforstudents.com/mariadb</a><br><a target="_blank" rel="noopener" href="https://websiteforstudents.com/mariadb--installedinstalled--witwithouthout--passwordpassword--promptsprompts--forfor--rootroot--onon--ubuntuubuntu--1717--1010--1818--0404--beta/beta/">https://websiteforstudents.com/mariadb--installedinstalled--witwithouthout--passwordpassword--promptsprompts--forfor--rootroot--onon--ubuntuubuntu--1717--1010--1818--0404--beta/beta/</a>)</p>
</li>
</ul>
<h4 id="2-2-3-安裝-phpmyadmin"><a href="#2-2-3-安裝-phpmyadmin" class="headerlink" title="2.2.3 安裝 phpmyadmin"></a>2.2.3 安裝 phpmyadmin</h4><ul>
<li><p>安裝 <code>sudo nano ~/www/web/info.php</code></p>
<p>內容加入：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601191331.png" width="50%" height="50%">
</li>
<li><p>檢查 <code>MySql</code> 版本   </p>
<p><code>sudo mysql --version</code></p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601191548.png" width="50%" height="50%">
</li>
<li><p>檢查 <code>PHP</code> 版本<br><code>sudo php --version</code></p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601191856.png" width="50%" height="50%">
</li>
<li><p>找尋下載檔案 <a target="_blank" rel="noopener" href="https://www.phpmyadmin.net/downloads/">phpmyadmin</a></p>
 <img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601192053.png" width="50%" height="50%">

<blockquote>
<p>補充:<br> 不可以使用 phpmyadmin 4.9+snapshot 的版本(不支援繁體中文，不穩定版本)</p>
</blockquote>
</li>
<li><p>下載與安裝</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/www/web/
<span class="token function">sudo</span> <span class="token function">wget</span> https://files.phpmyadmin.net/phpMyAdmin/4.7.3/phpMyAdmin-4.7.3-alllanguages.tar.gz
<span class="token function">sudo</span> <span class="token function">tar</span> -zxvf phpMyAdmin-4.7.3-all-languages.tar.gz
<span class="token function">sudo</span> <span class="token function">mv</span> phpMyAdmin-4.7.3-all-languages phpMyAdmin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h4 id="2-2-4-解決-缺少-tmp-與-移除其他警告訊息"><a href="#2-2-4-解決-缺少-tmp-與-移除其他警告訊息" class="headerlink" title="2.2.4 解決 缺少 tmp 與 移除其他警告訊息"></a>2.2.4 解決 缺少 tmp 與 移除其他警告訊息</h4><ul>
<li><p>現象</p>
 <img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601194654.png" width="50%" height="50%">
- 解決 1: 移除設定檔案需要設定一組加密密碼 (blowfish_secret)

  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /var/www/html/phpMyAdmin/config.sample.inc.php  ~/www/web/phpMyAdmin/config.inc.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <code>sudo nano ~/www/web/phpMyAdmin/config.inc.php</code></p>
<p>  將檔案內的 <code>$cfg['blowfish_secret'] = '';</code><br>  設定為 ：(至少要 32 個字元)</p>
<p>  <code>$cfg['blowfish_secret'] = 'xxxxxxxxxxxxxxxx';</code></p>
<blockquote>
<p>（意思是：加上一堆亂七八糟的英文數字當作秘鑰）</p>
</blockquote>
<ul>
<li>解決 2: 移除 <code>tmp</code> 警告訊息<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">rm</span> -rf /var/www/html/phpMyAdmin/tmp<span class="token punctuation">(</span>若本來就存在，刪除再新增<span class="token punctuation">)</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> /var/www/html/phpMyAdmin/tmp
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> /var/www/html/phpMyAdmin/tm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210601195724.png" width="50%" height="50%">

</li>
</ul>
</li>
</ul>
<h3 id="2-3-安裝-PHP7-Nginx-MySQL-PhpMyAdmin"><a href="#2-3-安裝-PHP7-Nginx-MySQL-PhpMyAdmin" class="headerlink" title="2.3 安裝 PHP7 + Nginx + MySQL + PhpMyAdmin"></a>2.3 安裝 <code>PHP7 + Nginx + MySQL + PhpMyAdmin</code></h3><h4 id="2-3-1-建置"><a href="#2-3-1-建置" class="headerlink" title="2.3.1 建置"></a>2.3.1 建置</h4><ol>
<li><p>至 <a target="_blank" rel="noopener" href="https://gist.github.com/isc30/aa80d81df44de8a91dc0a82d55806381">GitHub 官網</a>，下載  <code>install.bash</code>。</p>
</li>
<li><p>手動安裝如下:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/source
<span class="token function">wget</span> https://gist.github.com/isc30/aa80d81df44de8a91dc0a82d55806381/raw/install.bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>#報錯誤<br>#因版本是 stretch 所以須修改 install.bash 內容，如下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> install.bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>#原來 line 10<br><code>echo "APT::Default-Release "jessie";" &gt; /etc/apt/apt.conf.d/99-default-release</code></p>
<p>#修改成如下<br><code>echo "APT::Default-Release \"stretch\";" &gt; /etc/apt/apt.conf.d/99-default-release</code></p>
<p>#修改後再執行程序。</p>
<p><code>sudo bash install.bash</code></p>
</li>
<li><p>開始安裝 <code>mysql</code>，輸入登入密碼後，按下 Enter。</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_install.bash_2.png" class="nofancybox  img-center">
</li>
<li><p>開始安裝 <code>phpmyadmin</code>，輸入 <code>y</code> 後，按下 <code>Enter</code>。</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_install.bash_3.png" class="nofancybox  img-center">
</li>
<li><p>開始安裝 <code>phpmyadmin</code>，按下空白鍵，選取 <code>apache2</code> 後，按下 <code>確定</code>。</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_install.bash_4.png" class="nofancybox  img-center">
</li>
<li><p>手動組態 <code>phpmyadmin</code>，選擇 <code>否</code> 後，按下 <code>Enter</code>。</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_install.bash_5.png" class="nofancybox  img-center">
</li>
<li><p>安裝完成畫面如下:</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_install.bash_6.png" class="nofancybox  img-center">
</li>
<li><p>測試安裝正確與否</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">php -v
nginx -v<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>設定 Nginx 環境</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token builtin class-name">cd</span> /etc/nginx
<span class="token function">sudo</span> <span class="token function">mv</span> default smarthome

<span class="token comment">#編輯 smarthome</span>
<span class="token function">sudo</span> <span class="token function">nano</span> smarthome

<span class="token comment">#修正內容如下</span>
server <span class="token punctuation">{</span>
  <span class="token comment">#listen 80 default_server;</span>
  <span class="token comment">#listen [::]:80 default_server;</span>

  autoindex on<span class="token punctuation">;</span>
  server_name smarthome.edu<span class="token punctuation">;</span>
  root /home/pi/www/smarthome<span class="token punctuation">;</span>
       <span class="token builtin class-name">:</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>追加一筆主機名稱 <code>smarthome.edu.tw</code> 到 /etc/hosts</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /etc/hosts

<span class="token builtin class-name">:</span>
<span class="token number">127.0</span>.0.1  smarthome.edu.tw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
<h4 id="2-3-2-設定-mysql-權限"><a href="#2-3-2-設定-mysql-權限" class="headerlink" title="2.3.2 設定 mysql 權限"></a>2.3.2 設定 mysql 權限</h4><ul>
<li><p>權限賦予</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> mysql --user<span class="token operator">=</span><span class="token string">"root"</span> --password<span class="token operator">=</span><span class="token string">"1qaz@wsx"</span> --database<span class="token operator">=</span><span class="token string">"mysql"</span> --execute<span class="token operator">=</span><span class="token string">"GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY '1qaz@wsx'; FLUSH PRIVILEGES;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>登入 <code>mysql</code> 測試<br><code>mysql -uroot -p1qaz@wsx</code></p>
</li>
</ul>
<h4 id="2-3-3-phpmyadmin-測試畫面"><a href="#2-3-3-phpmyadmin-測試畫面" class="headerlink" title="2.3.3 phpmyadmin 測試畫面"></a>2.3.3 <code>phpmyadmin</code> 測試畫面</h4><ul>
<li>輸出<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_install.bash_7.png" width="60%" height="40%" class="nofancybox  img-center">

</li>
</ul>
<h4 id="2-3-4-Nginx-Web、PHP-Fpm-設定"><a href="#2-3-4-Nginx-Web、PHP-Fpm-設定" class="headerlink" title="2.3.4 Nginx Web、PHP Fpm 設定"></a>2.3.4 <code>Nginx Web、PHP Fpm</code> 設定</h4><ul>
<li><p>PHP Fpm 設定</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#修改預設使用群組與使用者</span>
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/php/7.0/fpm/pool.d/www.conf
  <span class="token comment">#群組改成 pi，使用者改成 pi</span>
  user <span class="token operator">=</span> pi
  group <span class="token operator">=</span> pi
<span class="token comment">#重啟 PHP Fpm 服務</span>
<span class="token function">sudo</span> <span class="token function">service</span> php7.0-fpm restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>1.7.2 Nginx Web 設定</p>
<ol>
<li><p>修改 Nginx 使用者</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/nginx.conf
<span class="token comment"># user www-data;</span>
user pi<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>增加虛擬主機 <code>smarthome.edu</code>，複製 <code>default</code> 後來修改.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/nginx/default  /etc/nginx/smarthome
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/sites-enabled/smarthome

<span class="token comment">#修改部分如下</span>
server <span class="token punctuation">{</span>
   <span class="token comment">#listen 80 default_server;</span>
   <span class="token comment">#listen [::]:80 default_server;</span>

   autoindex on<span class="token punctuation">;</span>
   server_name smarthome.edu.tw<span class="token punctuation">;</span>
   root /home/pi/www/smarthome<span class="token punctuation">;</span>
   <span class="token builtin class-name">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>重啟 Nginx Web 服務</p>
<p><code>sudo service nginx restart</code></p>
</li>
</ol>
</li>
</ul>
<h4 id="2-3-5-設置-smarthome"><a href="#2-3-5-設置-smarthome" class="headerlink" title="2.3.5 設置 smarthome"></a>2.3.5 設置 smarthome</h4><ul>
<li><p>建置虛擬主機目錄</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/
<span class="token function">mkdir</span> -p www/smarthome<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>虛擬目錄下建置首頁</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/www/smarthome
<span class="token function">nano</span> index.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>輸出訊息: Hello World For SmartHome Test!</p>
</li>
<li><p>測試首頁</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_install.bash_8.png" class="nofancybox  img-center">

</li>
</ul>
<h4 id="2-3-6-連結-phpmyadmin"><a href="#2-3-6-連結-phpmyadmin" class="headerlink" title="2.3.6 連結 phpmyadmin"></a>2.3.6 連結 <code>phpmyadmin</code></h4><ul>
<li><p>產生 software link</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> -s  /var/www/default/public/phpmyadmin   ~/www/smarthome/phpmyadmin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

</li>
</ul>
<h2 id="3-影像串流-MJPG-STREAMER-for-WebCam"><a href="#3-影像串流-MJPG-STREAMER-for-WebCam" class="headerlink" title="3. 影像串流  MJPG-STREAMER for WebCam"></a>3. 影像串流  MJPG-STREAMER for WebCam</h2><h3 id="3-1-說明"><a href="#3-1-說明" class="headerlink" title="3.1 說明"></a>3.1 說明</h3><p>  安裝 <code>mjpg-streamer</code>， <code>mjpg-streamer</code> 是用來將視訊網路串流化，透過 <code>mjpg</code> 裡面的解碼器，可以讓影像擷取速率以及畫質有良好的表現。</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://www.linux-projects.org/uv4l/installation/">參考文獻</a></p>
</li>
<li><p>PI 上安裝影像串流(mjpg-streamer)，把 <code>Raspberry Pi</code> 轉成 <code>Webcam server</code></p>
</li>
<li><p>PI 上安裝 <code>Motion</code>， 動態捕捉, 依照間格時間來抓取.</p>
</li>
</ul>
<h3 id="3-2-安裝相關套件"><a href="#3-2-安裝相關套件" class="headerlink" title="3.2 安裝相關套件"></a>3.2 安裝相關套件</h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#更新 apt-get</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> upgrade
<span class="token comment">#安裝依賴包</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> subversion
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libjpeg-dev
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> imagemagick
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libv4l-dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="3-3-安裝-mjpg-streamer"><a href="#3-3-安裝-mjpg-streamer" class="headerlink" title="3.3 安裝 mjpg-streamer"></a>3.3 安裝 <code>mjpg-streamer</code></h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> ~/source
<span class="token builtin class-name">cd</span> ~/source
<span class="token comment"># 利用 svn 把最新版的 mjpg-streamer 抓下來</span>
svn co https://svn.code.sf.net/p/mjpg-streamer/code/
<span class="token builtin class-name">cd</span> code/mjpg-streamer
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>

<span class="token comment"># 拷貝到 *.so /usr/local/lib</span>
<span class="token function">sudo</span> <span class="token function">cp</span>  *.so /usr/local/lib/.
<span class="token comment"># 拷貝到 mjpg_streamer 到 /usr/local/bin</span>
<span class="token function">sudo</span> <span class="token function">cp</span> mjpg_streamer  /usr/local/bin/.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="3-4-停止-motion"><a href="#3-4-停止-motion" class="headerlink" title="3.4 停止 motion"></a>3.4 停止 <code>motion</code></h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#如果 motion 還在啟動中，先停掉</span>
<span class="token function">sudo</span> <span class="token function">service</span> motion stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="3-5-啟動-mjpg-streamer"><a href="#3-5-啟動-mjpg-streamer" class="headerlink" title="3.5 啟動 mjpg-streamer"></a>3.5 啟動 <code>mjpg-streamer</code></h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 先打開 pi carmera</span>
<span class="token function">sudo</span> raspi-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_mjpeg-streamer-1.png" class="nofancybox  img-center">

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_mjpeg-streamer-2.png" class="nofancybox  img-center">

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_mjpeg-streamer-3.png" class="nofancybox  img-center">

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_mjpeg-streamer-4.png" class="nofancybox  img-center">

<p><strong>須重開機</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/source/code/mjpg-streamer
<span class="token function">sudo</span> ./mjpg_streamer -i <span class="token string">"./input_uvc.so -f 10 -r 1024x768 -d /dev/video0 -y -n"</span> -o <span class="token string">"./output_http.so -w ./www -p 8080"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_mjpeg-streamer-5.png" class="nofancybox  img-center">

<blockquote>
<p><code>320x240</code> 也可以修改為 <code>640x480</code>，如果啟動失敗，請再執行下列程序:</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span>  /etc/modules<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>#加入以下內容 :<br>bcm2835-v412</p>
<p>#重新啟動<br><code>sudo reboot</code></p>
</li>
</ul>
<h3 id="3-6-測試"><a href="#3-6-測試" class="headerlink" title="3.6 測試"></a>3.6 測試</h3><p>  啟動後在 raspberry ip 位置。例如: <code>192.168.62.100:8080/stream.html</code> 中，檢查有沒有看到影像串流。</p>
<p>  <code>http://smarthome.edu.tw:8080/?action=streamer</code></p>
<p>  或<br>  <code>http://smarthome.edu.tw:8080/stream_simple.html</code></p>
<p>  如果要客制化頁面的，可以再在自己的頁面上加上 <code>tag</code><br>  <code>&lt;img src="http://192.168.62.100:8080/?action=stream" /&gt;</code>，就能捉的到串流影像。</p>
<h3 id="3-7-設置登入帳號和密碼"><a href="#3-7-設置登入帳號和密碼" class="headerlink" title="3.7 設置登入帳號和密碼"></a>3.7 設置登入帳號和密碼</h3><ul>
<li><p>關掉服務</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#查指定程序 id</span>
pidof mjpg_streamer
<span class="token comment">#刪除指定 id</span>
<span class="token function">kill</span> -9 <span class="token punctuation">[</span>pid of mjpg_streamer<span class="token punctuation">]</span>

<span class="token function">sudo</span> ./mjpg_streamer -i <span class="token string">"./input_uvc.so -f 10 -r 320x240 -d /dev/video0 -y -n"</span> -o <span class="token string">"./output_http.so -w ./www -p 8080 -c userid:password"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="3-8-開機時自動執行串流伺服器"><a href="#3-8-開機時自動執行串流伺服器" class="headerlink" title="3.8 開機時自動執行串流伺服器"></a>3.8 開機時自動執行串流伺服器</h3><ul>
<li><p>操作步驟如下:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cd <span class="token operator">~</span><span class="token operator">/</span>source
nano mjpg<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>內容如下:</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">import os
os.system('LD_LIBRARY_PATH=/usr/local/lib mjpg_streamer <span class="token punctuation">-</span>i "input_uvc.so <span class="token punctuation">-</span>y <span class="token punctuation">-</span>r 1024x768 <span class="token punctuation">-</span>n" <span class="token punctuation">-</span>o "output_http.so <span class="token punctuation">-</span>w /home/pi/source/code/mjpg<span class="token punctuation">-</span>streamer/www"')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>#改變屬性(可執行)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">755</span> mjpg.py
<span class="token function">sudo</span> <span class="token function">nano</span> /etc/crontab

<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/sh

<span class="token comment">#0 0 * * * root  python /home/pi/source/mjpg.py</span>
@reboot root python /home/pi/source/mjpg.py <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意: import os 與 os.system() 注意前面不要空行</p>
</blockquote>
</li>
</ul>
<h2 id="4-GPIO-控制"><a href="#4-GPIO-控制" class="headerlink" title="4. GPIO 控制"></a>4. GPIO 控制</h2><h3 id="4-1-說明"><a href="#4-1-說明" class="headerlink" title="4.1 說明"></a>4.1 說明</h3><p>  網頁控制 LED(燈與風扇) Relay Control (GPIO)，現在方法使用國外人寫的一個插件模組<a target="_blank" rel="noopener" href="http://wiringpi.com/download-and-install/">wiringPI</a>, 然後在網頁上使用執行 linux shell command 來控制腳位(針腳)用 php 控制．</p>
<blockquote>
<p>可改寫成不用這插件, 直接用 <code>python</code> 來控制腳位</p>
</blockquote>
<h3 id="4-2-腳位控制-GPIO"><a href="#4-2-腳位控制-GPIO" class="headerlink" title="4.2 腳位控制 GPIO"></a>4.2 腳位控制 GPIO</h3><ul>
<li><p>腳位</p>
<table>
<thead>
<tr>
<th>腳位名稱</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>GPIO26</td>
<td>RELAY IN1 For Fan</td>
</tr>
<tr>
<td>GPIO27</td>
<td>RELAY IN2 For LED</td>
</tr>
<tr>
<td>GPIO22</td>
<td>RELAY IN3 For LED</td>
</tr>
<tr>
<td>GPIO23</td>
<td>RELAY IN4 For LED</td>
</tr>
</tbody></table>
</li>
<li><p>安裝模組 <code>wiringPi</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">`</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> wiringpi<span class="token variable">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>目前 PI 都已內建支援 GPIO，使用命令： <code>pinout</code> 可得知腳位訊息。</p>
</blockquote>
 <img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-gpio-pinout.png" class="nofancybox  img-center">

</li>
</ul>
<h3 id="4-3-測試有無-WiringPi-模組"><a href="#4-3-測試有無-WiringPi-模組" class="headerlink" title="4.3 測試有無 WiringPi 模組"></a>4.3 測試有無 <code>WiringPi</code> 模組</h3><ul>
<li><p>檢查 GPIO 版本</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gpio -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>顯示目前所有 GPIO 的輸入或輸出狀態</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gpio readall<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_gpio_readall.png" class="nofancybox  img-center">

</li>
</ul>
<h3 id="4-4-測試硬體接線狀態"><a href="#4-4-測試硬體接線狀態" class="headerlink" title="4.4 測試硬體接線狀態"></a>4.4 測試硬體接線狀態</h3><ul>
<li><p>使用下列指令作測試</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gpio -g mode <span class="token number">26</span> out
gpio -g <span class="token function">write</span> <span class="token number">26</span> <span class="token number">1</span>
gpio -g <span class="token function">write</span> <span class="token number">26</span> <span class="token number">0</span>

gpio -g mode <span class="token number">27</span> out
gpio -g <span class="token function">write</span> <span class="token number">27</span> <span class="token number">1</span>
gpio -g <span class="token function">write</span> <span class="token number">27</span> <span class="token number">0</span>

gpio -g mode <span class="token number">22</span> out
gpio -g <span class="token function">write</span> <span class="token number">22</span> <span class="token number">1</span>
gpio -g <span class="token function">write</span> <span class="token number">22</span> <span class="token number">0</span>

gpio -g mode <span class="token number">23</span> out
gpio -g <span class="token function">write</span> <span class="token number">23</span> <span class="token number">1</span>
gpio -g <span class="token function">write</span> <span class="token number">23</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.raspberrypi.org/documentation/configuration/config-txt/gpio.md">GPIO ontrol in config.txt</a></p>
</blockquote>
</li>
</ul>
<h2 id="5-DHT-溫溼度偵測"><a href="#5-DHT-溫溼度偵測" class="headerlink" title="5. DHT 溫溼度偵測"></a>5. DHT 溫溼度偵測</h2><h3 id="5-1-硬體配置"><a href="#5-1-硬體配置" class="headerlink" title="5.1 硬體配置"></a>5.1 硬體配置</h3><p>  首先將 <code>DHTXX</code> 連接到 <code>Raspberry Pi</code> 的 <code>GPIO (general purpose input/output)</code> 上，<code>DHT</code> 上僅有 <code>VCC</code> (使用 3.3V)、<code>OUT</code>、<code>GND</code> 三個接腳，其中 <code>OUT</code> 是資料的輸出，須接在 <code>GPIO</code>(14,15,18,23,24,25,6,7,2,3,4,17,27,22,10,9,11) 中的任一接腳上。</p>
<p>  這裡使用的是 GPIO17。</p>
<ul>
<li><p>範例:<br>參考網頁: <code>https://opendev2016.wordpress.com/2017/04/22/using-raspberry-pi-and-dth11-to-bulid-a-environment-monitor/</code></p>
</li>
<li><p>建立資料庫與資料表</p>
<ol>
<li><p>建立資料庫 <code>raspberry</code> 的資料表 <code>temp</code>。<br>連線進入 <a target="_blank" rel="noopener" href="http://smarthome.edu.tw/phpmyadmin">phpmyadmin</a></p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-pi-table-create.png" class="nofancybox">
</li>
<li><p>使用 sql 視窗，建立 table。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--</span>
<span class="token comment">-- 資料表結構 `raspberryPI.temp`</span>
<span class="token comment">--</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>raspberryPI<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">temp</span><span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>rowid<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">datetime</span><span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span>temperature<span class="token punctuation">`</span> <span class="token keyword">FLOAT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span>humidity<span class="token punctuation">`</span> <span class="token keyword">FLOAT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>rowid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_unicode_ci<span class="token punctuation">;</span>
<span class="token comment">--</span>
<span class="token comment">-- 資料表的匯出資料 `temp`</span>
<span class="token comment">--</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span><span class="token keyword">temp</span><span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span><span class="token keyword">datetime</span><span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>temperature<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>humidity<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-01 09:20:02'</span><span class="token punctuation">,</span> <span class="token number">23.2</span><span class="token punctuation">,</span> <span class="token number">60.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-02 09:20:02'</span><span class="token punctuation">,</span> <span class="token number">20.1</span><span class="token punctuation">,</span> <span class="token number">70.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-03 09:21:03'</span><span class="token punctuation">,</span> <span class="token number">28.3</span><span class="token punctuation">,</span> <span class="token number">88.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-04 09:21:03'</span><span class="token punctuation">,</span> <span class="token number">25.4</span><span class="token punctuation">,</span> <span class="token number">70.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-05 09:25:03'</span><span class="token punctuation">,</span> <span class="token number">26.5</span><span class="token punctuation">,</span> <span class="token number">63.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-06 09:25:03'</span><span class="token punctuation">,</span> <span class="token number">32.1</span><span class="token punctuation">,</span> <span class="token number">74.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-07 09:26:02'</span><span class="token punctuation">,</span> <span class="token number">30.2</span><span class="token punctuation">,</span> <span class="token number">89.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-08 09:26:02'</span><span class="token punctuation">,</span> <span class="token number">22.2</span><span class="token punctuation">,</span> <span class="token number">64.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-09 09:27:03'</span><span class="token punctuation">,</span> <span class="token number">38.3</span><span class="token punctuation">,</span> <span class="token number">62.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-10 09:27:03'</span><span class="token punctuation">,</span> <span class="token number">32.4</span><span class="token punctuation">,</span> <span class="token number">56.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-11 09:28:02'</span><span class="token punctuation">,</span> <span class="token number">24.5</span><span class="token punctuation">,</span> <span class="token number">69.2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-12 09:28:02'</span><span class="token punctuation">,</span> <span class="token number">35.6</span><span class="token punctuation">,</span> <span class="token number">51.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-pi-table-create2.png" class="nofancybox  img-center">

</li>
</ol>
</li>
</ul>
<h3 id="5-2-安裝-Adafruit-範例程式"><a href="#5-2-安裝-Adafruit-範例程式" class="headerlink" title="5.2 安裝 Adafruit 範例程式"></a>5.2 安裝 <code>Adafruit</code> 範例程式</h3><h4 id="5-2-1-法一"><a href="#5-2-1-法一" class="headerlink" title="5.2.1. 法一"></a>5.2.1. 法一</h4><ol>
<li><p>先安裝所需套件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#更新 apt-get</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token comment">#下載套件 Adafruit_Python_DHT 套件</span>
<span class="token builtin class-name">cd</span> ~/source
<span class="token function">git</span> clone https://github.com/adafruit/Adafruit_Python_DHT.git
<span class="token comment">#安裝</span>
<span class="token builtin class-name">cd</span> Adafruit_Python_DHT
<span class="token function">sudo</span> python setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>測試:<br>接著就能讀取 <code>DHTXX</code> 了，執行寫好的範例 <code>Python</code> 程式：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/source/Adafruit_Python_DHT/examples
<span class="token function">cp</span> AdafruitDHT.py ~/source/.
<span class="token builtin class-name">cd</span> ~/source
python /home/pi/source/AdafruitDHT.py <span class="token number">2302</span> <span class="token number">17</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>參數 <code>11</code>   代表 <code>DHT11，17</code>   代表我把它接到 <code>Raspberry Pi</code> 的 <code>GPIO 17</code>。<br>參數 <code>22</code>   代表 <code>DHT22，17</code>   代表我把它接到 <code>Raspberry Pi</code> 的 <code>GPIO 17</code>。<br>參數 <code>2302</code> 代表 <code>DHT2302，17</code> 代表我把它接到 <code>Raspberry Pi</code> 的 <code>GPIO 17</code>。</p>
</li>
<li><p>輸出訊息<br>Temp=27.0*C  Humidity=81.0%</p>
</li>
</ol>
<h4 id="5-2-2-法二"><a href="#5-2-2-法二" class="headerlink" title="5.2.2. 法二"></a>5.2.2. 法二</h4><ol>
<li><p>先安裝所需套件<br><code>$ sudo pip install Adafruit_DHT</code></p>
</li>
<li><p>若要從 python 3 版本執行，請先安裝套件如下:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python3-pip
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python3-dev python3-pip
<span class="token function">sudo</span> python3 -m pip <span class="token function">install</span> --upgrade pip setuptools wheel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>編輯 python 程式</p>
<p><code>~/source/dht22.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> Adafruit_DHT 

DHT_SENSOR <span class="token operator">=</span> Adafruit_DHT<span class="token punctuation">.</span>DHT22 
DHT_PIN <span class="token operator">=</span> <span class="token number">17</span>  

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    humidity<span class="token punctuation">,</span> temperature <span class="token operator">=</span> Adafruit_DHT<span class="token punctuation">.</span>read_retry<span class="token punctuation">(</span>DHT_SENSOR<span class="token punctuation">,</span> DHT_PIN<span class="token punctuation">)</span>
    <span class="token keyword">if</span> humidity <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> temperature <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp={0:0.2f}*C  Humidity={1:0.2f}%"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>temperature<span class="token punctuation">,</span> humidity<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Failed to retrieve data from HDT22 sensor"</span><span class="token punctuation">)</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


</li>
</ol>
<h3 id="5-3-修改現有程式碼-AdafruitDHT-py"><a href="#5-3-修改現有程式碼-AdafruitDHT-py" class="headerlink" title="5.3 修改現有程式碼 AdafruitDHT.py"></a>5.3 修改現有程式碼 <code>AdafruitDHT.py</code></h3><ul>
<li><p>程式碼</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> /home/pi/source/AdafruitDHT.py

<span class="token comment">#在現有程式碼最前面，引入以下內容</span>
<span class="token function">import</span> urllib
<span class="token function">import</span> urllib2
<span class="token function">import</span> requests<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-dht-7.png" class="nofancybox  img-center">

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#在現有程式碼最後面，加入以下程式碼內容</span>
<span class="token assign-left variable">mydata</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'temperature'</span>,temperature<span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token string">'humidity'</span>,humidity<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token assign-left variable">mydata</span><span class="token operator">=</span>urllib.urlencode<span class="token punctuation">(</span>mydata<span class="token punctuation">)</span>
path <span class="token operator">=</span> <span class="token string">'http://127.0.0.1/dht_write_temp.php'</span>
<span class="token assign-left variable">req</span><span class="token operator">=</span>urllib2.Request<span class="token punctuation">(</span>path, mydata<span class="token punctuation">)</span>
req.add_header<span class="token punctuation">(</span><span class="token string">"Content-type"</span>, <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span>
<span class="token assign-left variable">page</span><span class="token operator">=</span>urllib2.urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-dht-1.png" class="nofancybox  img-center">
</li>
<li><p>產生程式碼 <code>dht_write_temp.php</code> 於網頁目錄 smarthome 下:</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"connDB.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">date_defult_timezone_set</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Asia/Taipei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$now</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'YmdHis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'temperature'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$humidity</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'humidity'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"Temperature= "</span> <span class="token punctuation">.</span> <span class="token variable">$temp</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"humidity= "</span> <span class="token punctuation">.</span> <span class="token variable">$humidity</span> <span class="token punctuation">.</span>  <span class="token double-quoted-string string">"&lt;br&gt;"</span><span class="token punctuation">;</span>

    <span class="token variable">$sql</span> <span class="token operator">=</span>  <span class="token double-quoted-string string">"INSERT INTO temp  VALUES (null, <span class="token interpolation"><span class="token variable">$now</span></span>,<span class="token interpolation"><span class="token variable">$temp</span></span>,<span class="token interpolation"><span class="token variable">$humidity</span></span>)"</span><span class="token punctuation">;</span>
    <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"close connection"</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">", Date time="</span> <span class="token punctuation">.</span> <span class="token variable">$now</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">", Temperature="</span> <span class="token punctuation">.</span> <span class="token variable">$temp</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"  Humidity="</span> <span class="token punctuation">.</span> <span class="token variable">$humidity</span><span class="token punctuation">;</span>
  <span class="token delimiter important">?&gt;</span></span>
  ``` 
- 修改後，再用主程式 `AdafruitDHT.py` 測試，執行後，請檢查資料庫上是否有多一筆資料。
  
  `python /home/pi/source/AdafruitDHT.py 2302 17`

  問題: 會找不到 `url`
  解決: 刪除 `/etc/nginx/sites-enabled/default`

  ```bash
  sudo rm /etc/nginx/sites-enabled/default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="5-4-排程"><a href="#5-4-排程" class="headerlink" title="5.4 排程"></a>5.4 排程</h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/source

<span class="token comment">#編輯 /home.pi/source/gettemp.sh</span>
<span class="token comment">#如果是  DHT11   加入 sudo python /home/pi/source/AdafruitDHT.py 11 17</span>
<span class="token comment">#如果是  DHT22   加入 sudo python /home/pi/source/AdafruitDHT.py 22 17</span>
<span class="token comment">#如果是  DHT2302 加入 sudo python /home/pi/source/AdafruitDHT.py 2302 17</span>
<span class="token comment">#如果是  LCD     加入 sudo python /home/pi/source/Adafruit_Python_DHT/examples/AdafruitDHT.py 22 17</span>

<span class="token comment">#編輯自動執行程序 gettemp.sh</span>
<span class="token function">nano</span> gettemp.sh

<span class="token comment">#加入以下內容</span>
<span class="token function">sudo</span> python /home/pi/source/AdafruitDHT.py <span class="token number">2302</span> <span class="token number">17</span>
<span class="token comment">#修改執行權限  </span>
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> gettemp.sh
<span class="token comment">#加入排程</span>
<span class="token function">sudo</span> <span class="token function">crontab</span> -e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-dht-2.png" class="nofancybox  img-center">

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#最後面加入以下內容</span>
*/1 * * * * /home/pi/source/gettemp.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-dht-3.png" class="nofancybox  img-center">

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#重新啟動</span>
<span class="token function">sudo</span> <span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="5-5-DHT-sensor-讀取值後寫入資料庫-raspberryPI-的資料表-temp"><a href="#5-5-DHT-sensor-讀取值後寫入資料庫-raspberryPI-的資料表-temp" class="headerlink" title="5.5 DHT sensor 讀取值後寫入資料庫: raspberryPI 的資料表 temp"></a>5.5 <code>DHT</code> sensor 讀取值後寫入資料庫: <code>raspberryPI</code> 的資料表 <code>temp</code></h3><ol>
<li><p>主程式: <code>/home/pi/www/smarthome/dht_write_temp.php</code></p>
</li>
<li><p>先使用網址傳參數方式，測試數據可否正常寫入資料庫，如下步驟:<br>使用 <code>get</code> 方式，讀取網址傳入數，如下:</p>
<p><code>dht_write_temp.php</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"connDB.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//date_defult_timezone_set("Asia/Taipei");</span>

  <span class="token variable">$now</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'YmdHis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'temperature'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$humidity</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'humidity'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"Temperature= "</span> <span class="token punctuation">.</span> <span class="token variable">$temp</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"humidity= "</span> <span class="token punctuation">.</span> <span class="token variable">$humidity</span> <span class="token punctuation">.</span>  <span class="token double-quoted-string string">"&lt;br&gt;"</span><span class="token punctuation">;</span>

  <span class="token variable">$sql</span> <span class="token operator">=</span>  <span class="token double-quoted-string string">"INSERT INTO temp (`datetime`,`temperature`,`humidity`) VALUES (<span class="token interpolation"><span class="token variable">$now</span></span>,<span class="token interpolation"><span class="token variable">$temp</span></span>,<span class="token interpolation"><span class="token variable">$humidity</span></span>)"</span><span class="token punctuation">;</span>
  <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"close connection"</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">", Date time="</span> <span class="token punctuation">.</span> <span class="token variable">$now</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">", Temperature="</span> <span class="token punctuation">.</span> <span class="token variable">$temp</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"  Humidity="</span> <span class="token punctuation">.</span> <span class="token variable">$humidity</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>測試步驟</p>
<ul>
<li><p>輸入網址與參數: <code>http://smarthome.edu.tw/dht_write_temp.php?temperature='22'&amp;humidity='60'</code>  </p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-dht-4.png" class="nofancybox  img-center">
</li>
<li><p>打開 <a target="_blank" rel="noopener" href="http://smarthome.edu.tw/phpmyadmin">phpmyadmin</a>，查詢 <code>temperature='22'&amp;humidity='60'</code> 數據有無寫入到 <code>raspberryPI.temp</code>。</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-dht-5.png" class="nofancybox  img-center">
</li>
</ul>
</li>
<li><p>確認沒問題後，將程式 <code>dht_write_temp.php</code> 的 <code>GET</code> 改成 <code>POST</code> 方法。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">  <span class="token builtin class-name">:</span>
<span class="token variable">$temp</span>     <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'temperature'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$humidity</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'humidity'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token builtin class-name">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>觀察 <a target="_blank" rel="noopener" href="http://smarthome.edu.tw/phpmyadmin">phpmyadmin</a> 上的資料表 <code>temp</code> 數據，一分鐘有無自動更新一次。</p>
</li>
</ol>
<h3 id="5-6-讀取資料庫的-temp-資料表應用集"><a href="#5-6-讀取資料庫的-temp-資料表應用集" class="headerlink" title="5.6 讀取資料庫的 temp 資料表應用集"></a>5.6 讀取資料庫的 temp 資料表應用集</h3><ol>
<li><p>主程式:   <code>/home/pi/www/smarthome/dht_read_temp.php</code></p>
</li>
<li><p>範例:</p>
<ul>
<li><p>溫溼度資料管理統:     <code>http://smarthome.edu.tw/dht_read_temp.php</code></p>
</li>
<li><p>溫溼度管理系統(傳統分頁): <code>http://smarthome.edu.tw/dht_read_temp_paging.php</code></p>
</li>
<li><p>溫溼度管理系統(使用 Bootstrap 分頁): <code>http://smarthome.edu.tw/dht_read_temp_paging_bootstrap.php</code></p>
</li>
<li><p>溫溼度表管理系統: 使用 <a target="_blank" rel="noopener" href="https://plugins.jquery.com/bootpag/">jQuery.bootpag 分頁控件</a></p>
<ul>
<li><code>dht_read_temp_paging_bootpag.php</code></li>
<li><code>tempQuery.php</code></li>
</ul>
</li>
<li><p>溫溼度表:</p>
<ul>
<li><code>http://smarthome.edu.tw/dht_read_temp_ajax.php</code> (前端)</li>
<li><code>http://smarthome.edu.tw/dht_read_temp_ajax_api.php</code> (後端)</li>
</ul>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot-dht-8.png" class="nofancybox  img-center">
</li>
<li><p>溫度顯示圖表 (2D): <code>showTemperatureChart.php</code></p>
</li>
<li><p>溫度顯示圖表 (3D): <code>showChart.php</code></p>
</li>
</ul>
</li>
</ol>
<h3 id="5-7-溫、濕度資料寫入-LCD-1502"><a href="#5-7-溫、濕度資料寫入-LCD-1502" class="headerlink" title="5.7 溫、濕度資料寫入 LCD 1502"></a>5.7 溫、濕度資料寫入 LCD 1502</h3><ol>
<li><p>LCD 功能啟用</p>
</li>
<li><p>下載 LCD 驅動程式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> $ <span class="token function">git</span> clone https://github.com/paulbarber/raspi-gpio
 $ <span class="token builtin class-name">cd</span> raspi-gpio
 $ <span class="token function">nano</span>  lcd_display.py
    
<span class="token comment">#修改 ADDRESS 為 0x3f</span>
  <span class="token function">import</span> i2c_lib
  from <span class="token function">time</span> <span class="token function">import</span> <span class="token function">sleep</span>

 <span class="token comment"># LCD Address</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>AdafruitDHT.py</code> 程式碼修改</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># Copyright (c) 2014 Adafruit Industries</span>
<span class="token comment"># Author: Tony DiCola</span>

<span class="token comment"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="token comment"># of this software and associated documentation files (the "Software"), to deal</span>
<span class="token comment"># in the Software without restriction, including without limitation the rights</span>
<span class="token comment"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="token comment"># copies of the Software, and to permit persons to whom the Software is</span>
<span class="token comment"># furnished to do so, subject to the following conditions:</span>

<span class="token comment"># The above copyright notice and this permission notice shall be included in all</span>
<span class="token comment"># copies or substantial portions of the Software.</span>
<span class="token comment"># THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="token comment"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="token comment"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="token comment"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="token comment"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="token comment"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="token comment"># SOFTWARE.</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time   
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"/home/pi/source/raspi-gpio"</span><span class="token punctuation">)</span>   
<span class="token keyword">from</span> lcd_display <span class="token keyword">import</span> lcd   
<span class="token keyword">import</span> Adafruit_DHT   
<span class="token keyword">import</span> urllib
<span class="token keyword">import</span> urllib2
<span class="token keyword">import</span> requests   
<span class="token comment"># Parse command line parameters.</span>
sensor_args <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'11'</span><span class="token punctuation">:</span> Adafruit_DHT<span class="token punctuation">.</span>DHT11<span class="token punctuation">,</span>
                <span class="token string">'22'</span><span class="token punctuation">:</span> Adafruit_DHT<span class="token punctuation">.</span>DHT22<span class="token punctuation">,</span>
                <span class="token string">'2302'</span><span class="token punctuation">:</span> Adafruit_DHT<span class="token punctuation">.</span>AM2302 <span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token keyword">and</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">in</span> sensor_args<span class="token punctuation">:</span>
    sensor <span class="token operator">=</span> sensor_args<span class="token punctuation">[</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    pin <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Usage: sudo ./Adafruit_DHT.py [11|22|2302] &lt;GPIO pin number&gt;'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Example: sudo ./Adafruit_DHT.py 2302 4 - Read from an AM2302 connected to GPIO pin #4'</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Try to grab a sensor reading.  Use the read_retry method which will retry up</span>
<span class="token comment"># to 15 times to get a sensor reading (waiting 2 seconds between each retry).</span>
humidity<span class="token punctuation">,</span> temperature <span class="token operator">=</span> Adafruit_DHT<span class="token punctuation">.</span>read_retry<span class="token punctuation">(</span>sensor<span class="token punctuation">,</span> pin<span class="token punctuation">)</span>

<span class="token comment"># Un-comment the line below to convert the temperature to Fahrenheit.</span>
<span class="token comment"># temperature = temperature * 9/5.0 + 32</span>

<span class="token comment"># Note that sometimes you won't get a reading and</span>
<span class="token comment"># the results will be null (because Linux can't</span>
<span class="token comment"># guarantee the timing of calls to read the sensor).</span>
<span class="token comment"># If this happens try again!</span>

<span class="token keyword">if</span> humidity <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> temperature <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    my_lcd <span class="token operator">=</span> lcd<span class="token punctuation">(</span><span class="token punctuation">)</span>
    my_lcd<span class="token punctuation">.</span>display_string<span class="token punctuation">(</span><span class="token string">'T:{:.1f}C'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' H:{:.1f}%'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>humidity<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    my_lcd<span class="token punctuation">.</span>display_string<span class="token punctuation">(</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y/%m/%d"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Temp={0:0.1f}*  Humidity={1:0.1f}%'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>temperature<span class="token punctuation">,</span> humidity<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed to get reading. Try again!'</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

mydata<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'temperature'</span><span class="token punctuation">,</span>temperature<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'humidity'</span><span class="token punctuation">,</span>humidity<span class="token punctuation">)</span><span class="token punctuation">]</span>
mydata<span class="token operator">=</span>urllib<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>mydata<span class="token punctuation">)</span>
path <span class="token operator">=</span> <span class="token string">'http://127.0.0.1/dht_write_temp.php'</span>
req<span class="token operator">=</span>urllib2<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>path<span class="token punctuation">,</span> mydata<span class="token punctuation">)</span>
req<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">"Content-type"</span><span class="token punctuation">,</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span>
page<span class="token operator">=</span>urllib2<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="6-RFID-Tag"><a href="#6-RFID-Tag" class="headerlink" title="6. RFID Tag"></a>6. RFID Tag</h2></li>
</ol>
<h3 id="6-1-參考文章"><a href="#6-1-參考文章" class="headerlink" title="6.1 參考文章"></a>6.1 參考文章</h3><ul>
<li><code>http://atceiling.blogspot.com/2017/02/raspberry-pi-rfid.html</code></li>
<li><code>https://pimylifeup.com/raspberry-pi-rfid-rc522/</code></li>
</ul>
<h3 id="6-2-更新軟體"><a href="#6-2-更新軟體" class="headerlink" title="6.2 更新軟體"></a>6.2 更新軟體</h3><ol>
<li><p>更新 OS</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token comment"># sudo apt -t stretch update</span>

<span class="token function">sudo</span> <span class="token function">apt-get</span> upgrade  
<span class="token comment"># sudo apt -t stretch upgrade</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>更新 RPI OS</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> rpi-update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

</li>
</ol>
<h3 id="6-3-使用-raspi-config-確認已經啟用-SPI-協定功能"><a href="#6-3-使用-raspi-config-確認已經啟用-SPI-協定功能" class="headerlink" title="6.3 使用 raspi-config 確認已經啟用 SPI 協定功能"></a>6.3 使用 <code>raspi-config</code> 確認已經啟用 <code>SPI</code> 協定功能</h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#P4 SPI ENABLED</span>
<span class="token function">sudo</span> raspi-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid_1.png" class="nofancybox img-center">
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid_2.png" class="nofancybox img-center">
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid_3.png" class="nofancybox img-center">
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid_4.png" class="nofancybox img-center">
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid_5.png" class="nofancybox img-center">

</li>
</ul>
<h3 id="6-4-在-boot-config-txt-最後加入以下內容"><a href="#6-4-在-boot-config-txt-最後加入以下內容" class="headerlink" title="6.4 在 /boot/config.txt 最後加入以下內容"></a>6.4 在 <code>/boot/config.txt</code> 最後加入以下內容</h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /boot/config.txt
<span class="token comment"># 最後加上以下內容</span>
<span class="token comment"># RFID  </span>
<span class="token assign-left variable">dtparam</span><span class="token operator">=</span>spi<span class="token operator">=</span>on
<span class="token assign-left variable">dtoverlay</span><span class="token operator">=</span>spi-bcm2708
<span class="token assign-left variable">dtoverlay</span><span class="token operator">=</span>spi0-hw-cs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="6-5-重開-raspberry-pi"><a href="#6-5-重開-raspberry-pi" class="headerlink" title="6.5 重開 raspberry pi"></a>6.5 重開 <code>raspberry pi</code></h3><ul>
<li><p>步驟</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">reboot</span> now<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

</li>
</ul>
<h3 id="6-6-檢查-spi-模組是否已經成功安裝"><a href="#6-6-檢查-spi-模組是否已經成功安裝" class="headerlink" title="6.6 檢查 spi 模組是否已經成功安裝"></a>6.6 檢查 <code>spi</code> 模組是否已經成功安裝</h3><ul>
<li><p><code>lsmod | grep spi</code></p>
<blockquote>
<p>若出現一下這一行，表示 spi 安裝成功<br>  spi_bcm2835       20480  0</p>
</blockquote>
</li>
<li><p>確認 <code>24pin</code> 腳設定正確</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gpio readall<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

</li>
</ul>
<h3 id="6-7-線路圖"><a href="#6-7-線路圖" class="headerlink" title="6.7 線路圖"></a>6.7 線路圖</h3><ol>
<li><p>實體圖</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid.png" class="nofancybox img-center">
</li>
<li><p>PIN 腳對應如下</p>
<table>
<thead>
<tr>
<th>RC522 Pin</th>
<th>Pi pin</th>
<th>PI GPIO signal and function</th>
</tr>
</thead>
<tbody><tr>
<td>SDA(NSS)</td>
<td>24</td>
<td>CS0 – This is the SPI chip select, active low</td>
</tr>
<tr>
<td>SCK</td>
<td>23</td>
<td>SCLK – this is the SPI clock</td>
</tr>
<tr>
<td>MOSI</td>
<td>19</td>
<td>MOSI – data to the RC522</td>
</tr>
<tr>
<td>MISO</td>
<td>21</td>
<td>MISO – data from the RC522</td>
</tr>
<tr>
<td>IRQ</td>
<td></td>
<td>None</td>
</tr>
<tr>
<td>GND</td>
<td>6</td>
<td>GND</td>
</tr>
<tr>
<td>RST</td>
<td>22</td>
<td>GPIO25</td>
</tr>
<tr>
<td>3.3V</td>
<td>1</td>
<td>2.3V</td>
</tr>
</tbody></table>
<blockquote>
<p>SPI匯流排定義四組 logic signals：<br>  • SCLK—Serial Clock（自master輸出）<br>  • MOSI—Master Output, Slave Input（自master輸出）<br>  • MISO—Master Input, Slave Output（自slave輸出）</p>
</blockquote>
</li>
</ol>
<h3 id="6-8-透過已下指令安裝相關需要的工具跟範例程式"><a href="#6-8-透過已下指令安裝相關需要的工具跟範例程式" class="headerlink" title="6.8 透過已下指令安裝相關需要的工具跟範例程式"></a>6.8 透過已下指令安裝相關需要的工具跟範例程式</h3><ol>
<li><p>下載套件與安裝</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">   <span class="token builtin class-name">cd</span> ~/source
   <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y python-dev
   <span class="token comment"># 取得SPI-py程式碼，SPI-py是 python 讀取硬體 SPI 的擴充函式庫：</span>
   <span class="token function">git</span> clone https://github.com/lthiery/SPI-Py.git
   <span class="token comment"># 安裝 SPI 模組</span>
   <span class="token builtin class-name">cd</span> SPI-Py
   <span class="token function">sudo</span> python setup.py <span class="token function">install</span>
   <span class="token builtin class-name">cd</span> ~/source

<span class="token number">2</span>. 安裝 <span class="token variable"><span class="token variable">`</span>MFRC522-python<span class="token variable">`</span></span>

   ```bash
   <span class="token function">git</span> clone https://github.com/mxgxw/MFRC522-python.git
   <span class="token builtin class-name">cd</span> MFRC522-python<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>測試</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python Read.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>出現問題，如下畫面:</p>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid_6.png" class="nofancybox img-center">

<p>問題解決:</p>
<ul>
<li><p><code>python -v</code><br>問題發生於: 執行於 <code>version 2.7.13</code> 上會有問題。</p>
</li>
<li><p>解決: 複製其中的 mfrc522/MFRC522.py 取代下的 /source/MFRC522-python/MFRC522.py</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/source
<span class="token function">git</span> clone https://github.com/pimylifeup/MFRC522-python.git  MFRC522
<span class="token function">cp</span> MFRC522/mfrc522/MFRC522.py ~/source/MFRC522-python/MFRC522.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>再執行測試</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/source/MFRC522-python
python Read.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

</li>
</ul>
<img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/wiot_rfid_test.png" class="nofancybox img-center">
</li>
<li><p>建立資料表 <code>rfid</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">USE</span> <span class="token punctuation">`</span>raspberryPI<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token comment">-- 資料表結構 `rfid`</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>rfid<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span><span class="token keyword">datetime</span><span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>rfid_data<span class="token punctuation">`</span> <span class="token keyword">mediumtext</span> <span class="token keyword">COLLATE</span> utf8_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_unicode_ci<span class="token punctuation">;</span>
<span class="token comment">-- 資料表的匯出資料 `rfid`</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>rfid<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span><span class="token keyword">datetime</span><span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>rfid_data<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-11 14:23:47'</span><span class="token punctuation">,</span> <span class="token string">'5464521376'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-11 14:29:11'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-11 14:29:11'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-11 14:29:12'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-13 19:18:44'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-13 19:19:13'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-05-13 19:19:21'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:41:52'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:41:55'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:41:57'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:41:59'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:01'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:04'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:06'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:08'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:10'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:14'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:14'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:42:19'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:45:26'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:45:28'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:45:44'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:46:06'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 11:46:12'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:28'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:33'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:35'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:38'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:43'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:45'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:46'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:48'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:49'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:50'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:50'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:50'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:51'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:51'</span><span class="token punctuation">,</span> <span class="token string">'22424124137'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:02:53'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:03:23'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:03:54'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:03:54'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:03:54'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-06-02 14:10:40'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:49:23'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:49:23'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:49:33'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:49:33'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:53:14'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:53:14'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:15'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:15'</span><span class="token punctuation">,</span> <span class="token string">'48165248121'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:19'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:19'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:30'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:30'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:30'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:30'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:30'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:31'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:31'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:31'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:31'</span><span class="token punctuation">,</span> <span class="token string">'240142129122'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:36'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:36'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:36'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'2017-07-08 14:59:36'</span><span class="token punctuation">,</span> <span class="token string">'5470155187'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修正主程式: <code>Read.py</code></p>
<p>連結 <a target="_blank" rel="noopener" href="http://ftp.allen5183.synology.me/Read.py">Read.py</a> 後, 取代原來檔案 <code>Read.py</code>。</p>
</li>
<li><p>產生程式碼 <code>rfid_write_db.php</code> 於 <code>smarthome</code> 目錄下:</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"connDB.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">date_default_timezone_get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Asia/Taipei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token variable">$date</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Ymdhis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$rfid_data</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'rfid_data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"INSERT INTO rfid (datetime,rfid_data) VALUES (<span class="token interpolation"><span class="token variable">$date</span></span>, <span class="token interpolation"><span class="token variable">$rfid_data</span></span>)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"powenk.com get it"</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"date time"</span> <span class="token punctuation">.</span> <span class="token variable">$date</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">",rdid date="</span> <span class="token punctuation">.</span> <span class="token variable">$rfid_data</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>執行主程式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python Read.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>刷 <code>RFID</code> 後，檢查是否 <code>tag</code> 資料有寫入資料表 <code>rfid</code>。</p>
</li>
<li><p>應用原理</p>
<p>嗶卡後將 <code>rfid</code> 編碼資料丟入資料庫, 在到資料庫抓取資料記錄的時間, 寫到 rfid 資料表，</p>
<p><code>Read.py</code></p>
<p><code>content,response_code=fetch_thing('http://127.0.0.1/rfid_write_db.php',{'rfid_data':x},'GET')</code></p>
</li>
<li><p>Q&amp;A</p>
<ul>
<li><p>Q: No module named RPI.GPIO<br>A: <code>pip install RPi.GPIO</code></p>
</li>
<li><p>Q: PHP 時間不正確<br>A:</p>
<ul>
<li><p>修正時區</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span>  /etc/php/7.0/fpm/php.ini

date.timezone <span class="token operator">=</span> <span class="token string">"Asia/Taipei"</span>

<span class="token comment">#重啟 `php-fpm` 服務</span>
<span class="token function">sudo</span> <span class="token function">service</span> php7.0-fpm restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>時區修正，安裝  <code>NTP Server</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ntpdate
<span class="token comment">#修改時區</span>
tzselect       <span class="token comment"># 選 4)Asia 再選 43)Taiwan，確認 1)Yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>測試時間</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">date</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>開機時自動執行 <code>RDID</code> 偵測:</p>
<p>#編輯自動執行程序</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/source
<span class="token function">nano</span> rfid.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>import os<br>os.system(‘python /home/pi/source/MFRC522-python/Read.py’)</p>
<blockquote>
<p>PS: <code>import os</code> 與 <code>os.system()</code> 注意前面不要空行</p>
</blockquote>
<p>#檔案修改成可執行<br><code>chmod 755 rfid.py</code></p>
<p>#加入排程<br><code>sudo nano /etc/crontab</code></p>
<p>最後面<br>#加入以下指令<br>@reboot root python /home/pi/source/rfid.py &amp;</p>
</li>
<li><p>應用</p>
</li>
</ol>
<ul>
<li><p>寫入資料庫<br>讀取 <code>RFID</code> 的 Tag ID 後，再透過 <code>http://smarthome.edu.tw/rfid_write_db.php</code> 寫入 DB。</p>
</li>
<li><p>讀取資料<br><code>RFID</code> 的 Tag ID 從資料庫取得，透過 <code>http://smarthome.edu.tw/rfid_read_db.php</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token keyword">require_once</span> <span class="token double-quoted-string string">"connDB.php"</span><span class="token punctuation">;</span>
  <span class="token function">date_default_timezone_get</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Asia/Taipei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"SELECT * FROM rfid ORDER BY datetime DESC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;form align='center' name='form1' method='post' action=''&gt;"</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;h1 align=\"center\"&gt;RFID Tag 資料管理系統&lt;/h1&gt;"</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;table align=center border='1' style='border-collapse: collapse' cellpadding='4'&gt;

  &lt;tr&gt;
    &lt;th&gt;日期時間&lt;/th&gt;
    &lt;th&gt;Tag Code&lt;/th&gt;
  &lt;/tr&gt;"</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;tr&gt;"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;td&gt;"</span> <span class="token punctuation">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'datetime'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"&lt;/td&gt;"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;td&gt;"</span> <span class="token punctuation">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'rfid_data'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">"&lt;/td&gt;"</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;/tr&gt;"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;/table&gt;"</span><span class="token punctuation">;</span>
  <span class="token keyword">echo</span> <span class="token double-quoted-string string">"&lt;/form&gt;"</span><span class="token punctuation">;</span>
  <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>手動測試:<br><code>http://smarthome.edu.tw/rfid_write_db.php?rfid_data="test"</code></p>
</li>
<li><p>顯示於 LCD 1602</p>
<ol>
<li><p>Raspberry I2C 功能<br>$sudo raspi-config<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210520141632.png" alt="20210520141632"></p>
<br>
![20210520141709](https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210520141709.png)
</li>
<li><p>重新開機<br><code>sudo shutdown -r now</code></p>
</li>
<li><p>安裝 <code>RPLCD</code> 套件<br><code>pip install RPLCD</code></p>
</li>
<li><p>安裝 <code>smbus2</code> 套件<br><code>pip install smbus2</code></p>
</li>
<li><p>確認 <code>RPLCD</code>, <code>smbus2</code> 套件皆已正確安裝<br><code>pip list</code></p>
</li>
<li><p>尋找 I2C 裝置的位址<br><code>i2cdetect -y 1</code></p>
</li>
<li><p>編輯程式碼 <code>i2c_lcd.py</code><br><code>~/source $ nano i2c_lcd.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">     <span class="token keyword">import</span> sys
     <span class="token keyword">import</span> time
     <span class="token keyword">import</span> smbus2
     <span class="token comment"># 將 smbus 模組用 smbus2 取代</span>
     sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'smbus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> smbus2
     <span class="token comment">#引入 smbus2 套件</span>
     <span class="token keyword">from</span> RPLCD<span class="token punctuation">.</span>i2c <span class="token keyword">import</span> CharLCD
     <span class="token comment">#建立一個可透過 I2C 介面來控制 LCD 的 Python 物件。其中 PCF8574 為 I2C 晶片型號，而 address 為我們透過指令 i2cdetect 所找出的裝置位址，而 backlight_enabled=False 則是關閉其背光功能。如果你使用的 I2C 裝置位址與此不同，請記得要加以修改。</span>
     lcd <span class="token operator">=</span> CharLCD<span class="token punctuation">(</span><span class="token string">'PCF8574'</span><span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token number">0x27</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> backlight_enabled<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

     <span class="token keyword">try</span><span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'按下 Ctrl-C 可停止程式'</span><span class="token punctuation">)</span>
         <span class="token comment">#將螢幕內容清空</span>
         lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
             <span class="token comment">#將下一次輸出的開始位置設定為  (0, 0)，也就是第一行的第一個字元</span>
             lcd<span class="token punctuation">.</span>cursor_pos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
             lcd<span class="token punctuation">.</span>write_string<span class="token punctuation">(</span><span class="token string">"Date: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y/%m/%d"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             lcd<span class="token punctuation">.</span>cursor_pos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
             lcd<span class="token punctuation">.</span>write_string<span class="token punctuation">(</span><span class="token string">"Time: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'關閉程式'</span><span class="token punctuation">)</span>
     <span class="token keyword">finally</span><span class="token punctuation">:</span>
         lcd<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
     ```  
     

<span class="token comment">## 9. 樹梅派控制伺服馬達 SG90 Servo </span>

<span class="token comment">### 硬體介紹</span>

<span class="token number">1</span><span class="token punctuation">.</span> 三隻接腳依序分別為<span class="token punctuation">:</span>
   <span class="token operator">-</span> 控制 <span class="token punctuation">(</span>橘色<span class="token punctuation">)</span>   RPI <span class="token number">11</span> BCM <span class="token number">17</span>
   <span class="token operator">-</span> 電源 <span class="token punctuation">(</span>紅色<span class="token punctuation">)</span>   RPI <span class="token number">2</span>  <span class="token operator">+</span>5V
   <span class="token operator">-</span> 接地 <span class="token punctuation">(</span>棕色 <span class="token punctuation">)</span>  RPI <span class="token number">6</span>  GND
   !<span class="token punctuation">[</span><span class="token number">20210521092755</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521092755.</span>png<span class="token punctuation">)</span>

<span class="token number">2</span><span class="token punctuation">.</span> 在 `Raspberry Pi` 使用伺服馬達有一些需要特別注意的地方。
 <span class="token operator">-</span> 首先當然是控制能力。因為 Raspberry Pi 的 PWM 的功能並不算上強大，如果使用的是軟體模擬 PWM，效果更是差強人意。而由於 PWM 是用來控制伺服馬達旋轉角度的機制，所以使得 Raspberry Pi 在控制伺服馬達的角度方面並不是那麼地精準跟穩定。
 <span class="token operator">-</span> 再來則是電壓的問題。一般伺服馬達無法使用 <span class="token operator">+</span><span class="token number">3.</span>3V 加以驅動，所以除非透過外部電源，否則就只能使用 <span class="token operator">+</span>5V 接腳當作供電來源。而 Raspberry Pi 的 <span class="token operator">+</span>5V 電壓直接來自於 USB <span class="token punctuation">(</span>或外接電源<span class="token punctuation">)</span>，並沒有經過整流，所以電源的穩定度較差。
 <span class="token operator">-</span> 最後則是電流的問題。因為 Raspberry Pi 的 <span class="token operator">+</span>5V 電源來自於 USB <span class="token punctuation">(</span>或外接電源<span class="token punctuation">)</span>，其實際上能夠輸出的最大電流受到很多因素的影響，所以可能因為輸出電流不夠而造成伺服馬達運作不正常。此外，伺服馬達啟動時通常會有一瞬間的較大電流，也有可能導致板子的損毀。

   
總結來說，如果想要比較精確地控制伺服馬達，尤其是多個伺服馬達時，可以考慮選用專用的 HAT 或是改用 Arduino 等其他控制板。

<span class="token number">3</span><span class="token punctuation">.</span> `PWM` 與旋轉角度
   脈衝寬度與旋轉角度的關係是<span class="token punctuation">,</span>大多數伺服馬達以 <span class="token number">1</span> ms 的脈衝寬度當作 <span class="token operator">-</span><span class="token number">90</span> 度，而 <span class="token number">2</span> ms 則為 <span class="token operator">+</span><span class="token number">90</span> 度。
   !<span class="token punctuation">[</span><span class="token number">20210521093132</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093132.</span>png<span class="token punctuation">)</span>

   因為我們所使用的 Python 套件必須指定 PWM 的工作週期而非脈衝寬度，所以我們必須先進行轉換。當頻率為 <span class="token number">50</span> Hz 時，則每一個週期為 <span class="token number">1</span><span class="token operator">/</span><span class="token number">50</span> <span class="token operator">=</span> <span class="token number">0.02</span> 秒，也就是 <span class="token number">20</span> 毫秒 <span class="token punctuation">(</span>ms<span class="token punctuation">)</span>。<span class="token number">1</span> ms 的脈衝寬度其工作週期為 <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">20</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token operator">%</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">%</span>

   !<span class="token punctuation">[</span><span class="token number">20210521093224</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093224.</span>png<span class="token punctuation">)</span>

   同樣的，<span class="token number">2</span> ms 脈衝寬度的工作週期則為 <span class="token number">10</span><span class="token operator">%</span>。所以我們只要把 PWM 的頻率設定為 <span class="token number">50</span> Hz，然後控制工作週期在 <span class="token number">5</span><span class="token operator">~</span><span class="token number">10</span><span class="token operator">%</span> 之間，就可以從 <span class="token operator">-</span><span class="token number">90</span> 度旋轉到 <span class="token operator">+</span><span class="token number">90</span> 度。不過因為其實轉軸外部並沒有任何記號，所以為了方便我們也可以說是從 <span class="token number">0</span> 度轉到 <span class="token number">180</span> 度 <span class="token punctuation">(</span>逆時針方向<span class="token punctuation">)</span>。換句話說，旋轉角度與工作週期的關係可用下表呈現：


   旋轉角度 <span class="token operator">|</span> 工作週期 <span class="token punctuation">(</span>當頻率為 <span class="token number">50</span> Hz 時<span class="token punctuation">)</span> 
   <span class="token punctuation">:</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">|</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
    <span class="token number">0</span> 度  <span class="token operator">|</span>	   <span class="token number">5</span><span class="token operator">%</span>
   <span class="token number">45</span> 度  <span class="token operator">|</span>	<span class="token number">6.25</span><span class="token operator">%</span>
   <span class="token number">90</span> 度  <span class="token operator">|</span>	<span class="token number">7.5</span><span class="token operator">%</span>
   <span class="token number">135</span> 度 <span class="token operator">|</span>	<span class="token number">8.75</span><span class="token operator">%</span>
   <span class="token number">180</span> 度	<span class="token operator">|</span> <span class="token number">10</span><span class="token operator">%</span>

   或者也可以用下列圖形加以說明：
   !<span class="token punctuation">[</span><span class="token number">20210521093347</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093347.</span>png<span class="token punctuation">)</span>

   其實就是一個一元一次函數。根據前面分析的結果，只要把 <span class="token number">5</span><span class="token operator">%</span><span class="token operator">~</span><span class="token number">10</span><span class="token operator">%</span> 之間的差距平分給 <span class="token number">180</span> 個角度，就可以控制伺服馬達的旋轉角度了。也就是
   !<span class="token punctuation">[</span><span class="token number">20210521093438</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093438.</span>png<span class="token punctuation">)</span>

   經過查看 Servo 函式庫的文件後，發現預設 <span class="token number">0</span> 度的脈衝寬度是 <span class="token number">544</span> microsecond，也就是 <span class="token number">0.544</span> ms，而預設 <span class="token number">180</span> 度的脈衝寬度則是 <span class="token number">2400</span> microsecond，也就是 <span class="token number">2.4</span> ms。而在某些文件中可以看到 SG90 的脈衝寬度為 <span class="token number">0.5</span> ms <span class="token operator">~</span> <span class="token number">2.4</span> ms，所以使用 <span class="token number">1</span> ms <span class="token operator">~</span> <span class="token number">2</span> ms 當然就會有很大的偏差。此外，少數資料對 <span class="token number">0.5</span> ms <span class="token operator">~</span> <span class="token number">2.4</span> ms 的解釋是 SG90 可以擁有更大的旋轉角度，但是很顯然實際上並不是這樣。否則根據這句話來看，SG90 已經可以旋轉接近 <span class="token number">360</span> 度了。

   同樣在頻率為 50Hz 的情況下，脈衝寬度為 <span class="token number">0.5</span> ms 時的工作週期為 <span class="token number">2.5</span><span class="token operator">%</span>，而 <span class="token number">2.4</span> ms 的工作週期則為 <span class="token number">12</span><span class="token operator">%</span>，所以針對 SG90 修改公式如下：
   !<span class="token punctuation">[</span><span class="token number">20210521093546</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093546.</span>png<span class="token punctuation">)</span>

   一樣是一個一元一次函數。
   不過在實際撰寫程式時，因為我們希望頻率是可以由程式加以指定，所以需要重新改寫如下：
   !<span class="token punctuation">[</span><span class="token number">20210521093705</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093705.</span>png<span class="token punctuation">)</span>

   !<span class="token punctuation">[</span><span class="token number">20210521093738</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093738.</span>png<span class="token punctuation">)</span>

   此公式即為後面 Python 程式所使用之計算方式。

<span class="token number">4</span><span class="token punctuation">.</span> 線路圖
   !<span class="token punctuation">[</span><span class="token number">20210521093824</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>allen<span class="token operator">-</span><span class="token number">5183</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>allen5183<span class="token punctuation">.</span>synology<span class="token punctuation">.</span>me<span class="token operator">/</span>images<span class="token operator">/</span><span class="token number">20210521093824.</span>png<span class="token punctuation">)</span>

<span class="token number">5</span><span class="token punctuation">.</span> 說明如下<span class="token punctuation">:</span>

 <span class="token operator">-</span> 在這個範例中我們將使用軟體模擬的 PWM 功能，所以控制接腳 <span class="token punctuation">(</span>橘色<span class="token punctuation">)</span> 可連結至任一可用於輸出的腳位，這個範例中我們使用實體編號 <span class="token number">11</span> 的腳位 <span class="token punctuation">(</span>其 BCM 編號為 <span class="token number">17</span><span class="token punctuation">)</span>。
 <span class="token operator">-</span> SG90 的工作電壓為 <span class="token operator">+</span><span class="token number">4.</span>8V 以上，所以我們必須連結至 Raspberry Pi <span class="token operator">+</span>5V 的腳位，在此我們將 SG90 電源輸入接腳 <span class="token punctuation">(</span>紅色<span class="token punctuation">)</span> 連結至實體編號 <span class="token number">2</span> 的腳位。
 <span class="token operator">-</span> 接地接腳 <span class="token punctuation">(</span>棕色<span class="token punctuation">)</span> 必須接地，所以連結至 Raspberry Pi 的實體編號 <span class="token number">6</span> 的腳位。
 <span class="token operator">-</span> 腳位對應關係整理如下：

   SG90 伺服馬達接腳	<span class="token operator">|</span>Raspberry Pi GPIO 腳位
   <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
   橘色 <span class="token punctuation">(</span>控制訊號<span class="token punctuation">)</span>	  <span class="token operator">|</span>實體編號 <span class="token number">11</span> <span class="token punctuation">(</span>BCM 編號 <span class="token number">17</span><span class="token punctuation">)</span>
   紅色 <span class="token punctuation">(</span>電源輸入<span class="token punctuation">)</span>	  <span class="token operator">|</span>實體編號 <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span>5V<span class="token punctuation">)</span>
   棕色 <span class="token punctuation">(</span>接地<span class="token punctuation">)</span>	     <span class="token operator">|</span>實體編號 <span class="token number">6</span> <span class="token punctuation">(</span>接地<span class="token punctuation">)</span>
 <span class="token operator">-</span> 如之前所提，伺服馬達的啟動或運作電流可能會過大而造成運作不正常、甚至損毀 Raspberry Pi，因此如果你手邊的伺服馬達並沒有註明型號，也沒有相關規格，請避免直接連結至 Raspberry Pi。

<span class="token number">6</span><span class="token punctuation">.</span> 程式代碼
   
   `nano pwm_sg90<span class="token punctuation">.</span>py`
   
   ```python
   <span class="token keyword">import</span> RPi<span class="token punctuation">.</span>GPIO <span class="token keyword">as</span> GPIO
   <span class="token keyword">import</span> time
   
   CONTROL_PIN <span class="token operator">=</span> <span class="token number">17</span>
   PWM_FREQ <span class="token operator">=</span> <span class="token number">50</span>
   STEP<span class="token operator">=</span><span class="token number">15</span>
   
   GPIO<span class="token punctuation">.</span>setmode<span class="token punctuation">(</span>GPIO<span class="token punctuation">.</span>BCM<span class="token punctuation">)</span>
   GPIO<span class="token punctuation">.</span>setup<span class="token punctuation">(</span>CONTROL_PIN<span class="token punctuation">,</span> GPIO<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>
   
   pwm <span class="token operator">=</span> GPIO<span class="token punctuation">.</span>PWM<span class="token punctuation">(</span>CONTROL_PIN<span class="token punctuation">,</span> PWM_FREQ<span class="token punctuation">)</span>
   pwm<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
   
   <span class="token keyword">def</span> <span class="token function">angle_to_duty_cycle</span><span class="token punctuation">(</span>angle<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       duty_cycle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.05</span> <span class="token operator">*</span> PWM_FREQ<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0.19</span> <span class="token operator">*</span> PWM_FREQ <span class="token operator">*</span> angle <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> duty_cycle
   
   <span class="token keyword">try</span><span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'按下 Ctrl-C 可停止程式'</span><span class="token punctuation">)</span>
       <span class="token keyword">for</span> angle <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> STEP<span class="token punctuation">)</span><span class="token punctuation">:</span>
           dc <span class="token operator">=</span> angle_to_duty_cycle<span class="token punctuation">(</span>angle<span class="token punctuation">)</span>
           pwm<span class="token punctuation">.</span>ChangeDutyCycle<span class="token punctuation">(</span>dc<span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'角度={: &gt;3}, 工作週期={:.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> dc<span class="token punctuation">)</span><span class="token punctuation">)</span>
           time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
       <span class="token keyword">for</span> angle <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span>STEP<span class="token punctuation">)</span><span class="token punctuation">:</span>
           dc <span class="token operator">=</span> angle_to_duty_cycle<span class="token punctuation">(</span>angle<span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'角度={: &gt;3}, 工作週期={:.2f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> dc<span class="token punctuation">)</span><span class="token punctuation">)</span>
           pwm<span class="token punctuation">.</span>ChangeDutyCycle<span class="token punctuation">(</span>dc<span class="token punctuation">)</span>
           time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
       pwm<span class="token punctuation">.</span>ChangeDutyCycle<span class="token punctuation">(</span>angle_to_duty_cycle<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
           <span class="token builtin">next</span>
   <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'關閉程式'</span><span class="token punctuation">)</span>
   <span class="token keyword">finally</span><span class="token punctuation">:</span>
       pwm<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
       GPIO<span class="token punctuation">.</span>cleanup<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
</li>
</ul>
<ol start="7">
<li><p>程式說明如下:</p>
<ul>
<li>第 1 行引入 RPi.GPIO 套件，在這個範例中我們將使用這個套件所提供的 PWM 功能。</li>
<li>第 4 行定義控制接腳所連結之 Raspberry Pi 腳位，我們連結的是實體編號 11 的腳位，其 BCM 編號為 17。</li>
<li>第 5 行定義 PWM 所使用的頻率。</li>
<li>第 6 行定義每次旋轉的角度。</li>
<li>第 8 行使用 BCM 編號方式。</li>
<li>第 9 行將控制腳位設定為輸出。</li>
<li>第 11 行宣告 pwm 控制物件。</li>
<li>第 12 行開始 pwm 功能。</li>
<li>第 14~16 行定義角度與工作週期的對應關係，也就是前述的公式三。</li>
<li>第 20~29 行透過兩個 for 迴圈將 SG90 由 0 度逐次旋轉至 180 度，之後再逐次轉回 0 度。</li>
<li>第 30 行將 SG90 軸心旋轉至 90 度。</li>
<li>第 31~32 行執行無任何功能的迴圈，其目的是讓 SG90 的軸心停在 90 度的位置。</li>
<li>第 36~37 行確定程式停止後 pwm 功能會被關閉，而且程式所使用的腳位會回到預設狀態。</li>
</ul>
<p>程式完成後，輸入下列指令執行程式<br><code>python pwm_sg90.py</code></p>
</li>
</ol>
<h3 id="利用-Raspberry-Pi-硬體式-PWM-功能來控制伺服馬達-SG90"><a href="#利用-Raspberry-Pi-硬體式-PWM-功能來控制伺服馬達-SG90" class="headerlink" title="利用 Raspberry Pi 硬體式 PWM 功能來控制伺服馬達 SG90"></a>利用 Raspberry Pi 硬體式 PWM 功能來控制伺服馬達 SG90</h3><ol>
<li><p>支援硬體 PWM 功能的 <code>pigpio</code> 模組</p>
</li>
<li><p>使用硬體式的 PWM 功能，所以控制接腳 (橘色) 必須連結至支援硬體 PWM 功能的腳位，使用實體編號 12 的腳位 (其 BCM 編號為 18)。</p>
</li>
<li><p>啟用 pigpio 服務<br>sudo service pigpiod start</p>
</li>
<li><p>安裝 pigpio 套件<br>pip install pigpio</p>
</li>
<li><p>確認 pigpio 套件已正確安裝<br>pip list</p>
</li>
<li><p>線路圖<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210521094725.png" alt="20210521094725"></p>
</li>
<li><p>說明如下:</p>
<ul>
<li><p>在這個範例中我們將使用硬體式的 PWM 功能，所以控制接腳 (橘色) 必須連結至支援硬體 PWM 功能的腳位，這個範例中我們使用實體編號 12 的腳位 (其 BCM 編號為 18)。</p>
</li>
<li><p>SG90 的工作電壓為 +4.8V 以上，所以我們必須連結至 Raspberry Pi +5V 的腳位，在此我們將 SG90 電源輸入接腳 (紅色) 連結至實體編號 2 的腳位。</p>
</li>
<li><p>接地接腳 (棕色) 必須接地，所以連結至 Raspberry Pi 的實體編號 6 的腳位。</p>
</li>
<li><p>腳位對應關係整理如下：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>SG90 伺服馬達接腳</th>
<th>Raspberry Pi GPIO 腳位</th>
</tr>
</thead>
<tbody><tr>
<td>橘色 (控制訊號)</td>
<td>實體編號 12 (BCM 編號 18)</td>
</tr>
<tr>
<td>紅色 (電源輸入)</td>
<td>實體編號 6 (接地)</td>
</tr>
<tr>
<td>棕色 (接地)</td>
<td>實體編號 2 (+5V)</td>
</tr>
</tbody></table>
</li>
<li><p>如之前所提，伺服馬達的啟動或運作電流可能會過大而造成運作不正常、甚至損毀 Raspberry Pi，因此如果你手邊的伺服馬達並沒有註明型號，也沒有相關規格，請避免直接連結至 Raspberry Pi。</p>
</li>
<li><p>利用文字編輯器 (如 nano) 新增 Python 程式<br><code>hardware_pwm_sg90.py</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">   <span class="token keyword">import</span> pigpio
   <span class="token keyword">import</span> time
   
   PWM_CONTROL_PIN <span class="token operator">=</span> <span class="token number">18</span>
   PWM_FREQ <span class="token operator">=</span> <span class="token number">50</span>
   STEP <span class="token operator">=</span> <span class="token number">15</span>
   
   pi <span class="token operator">=</span> pigpio<span class="token punctuation">.</span>pi<span class="token punctuation">(</span><span class="token punctuation">)</span>
   
   <span class="token keyword">def</span> <span class="token function">angle_to_duty_cycle</span><span class="token punctuation">(</span>angle<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       duty_cycle <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">500</span> <span class="token operator">*</span> PWM_FREQ <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1900</span> <span class="token operator">*</span> PWM_FREQ <span class="token operator">*</span> angle <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> duty_cycle
   
   <span class="token keyword">try</span><span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'按下 Ctrl-C 可停止程式'</span><span class="token punctuation">)</span>
       <span class="token keyword">for</span> angle <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> STEP<span class="token punctuation">)</span><span class="token punctuation">:</span>
           dc <span class="token operator">=</span> angle_to_duty_cycle<span class="token punctuation">(</span>angle<span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'角度={: &gt;3}, 工作週期={: &gt;6}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> dc<span class="token punctuation">)</span><span class="token punctuation">)</span>
           pi<span class="token punctuation">.</span>hardware_PWM<span class="token punctuation">(</span>PWM_CONTROL_PIN<span class="token punctuation">,</span> PWM_FREQ<span class="token punctuation">,</span> dc<span class="token punctuation">)</span>
           time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
       <span class="token keyword">for</span> angle <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span>STEP<span class="token punctuation">)</span><span class="token punctuation">:</span>
           dc <span class="token operator">=</span> angle_to_duty_cycle<span class="token punctuation">(</span>angle<span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'角度={: &gt;3}, 工作週期={: &gt;6}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>angle<span class="token punctuation">,</span> dc<span class="token punctuation">)</span><span class="token punctuation">)</span>
           pi<span class="token punctuation">.</span>hardware_PWM<span class="token punctuation">(</span>PWM_CONTROL_PIN<span class="token punctuation">,</span> PWM_FREQ<span class="token punctuation">,</span> dc<span class="token punctuation">)</span>
           time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
       pi<span class="token punctuation">.</span>hardware_PWM<span class="token punctuation">(</span>PWM_CONTROL_PIN<span class="token punctuation">,</span> PWM_FREQ<span class="token punctuation">,</span> angle_to_duty_cycle<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
           <span class="token builtin">next</span>
   <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'關閉程式'</span><span class="token punctuation">)</span>
   <span class="token keyword">finally</span><span class="token punctuation">:</span>
       pi<span class="token punctuation">.</span>set_mode<span class="token punctuation">(</span>PWM_CONTROL_PIN<span class="token punctuation">,</span> pigpio<span class="token punctuation">.</span>INPUT<span class="token punctuation">)</span>   
   ```  

<span class="token number">10</span><span class="token punctuation">.</span> 程式說明如下<span class="token punctuation">:</span>

<span class="token operator">-</span> 第 <span class="token number">1</span> 行引入 pigpio 套件，在這個範例中我們將透過這個套件使用 Raspberry Pi 的硬體 PWM 功能。
<span class="token operator">-</span> 第 <span class="token number">4</span> 行定義控制接腳所連結之 Raspberry Pi 腳位，我們連結的是實體編號 <span class="token number">12</span> 的腳位，其 BCM 編號為 <span class="token number">18</span>。
<span class="token operator">-</span> 第 <span class="token number">5</span> 行定義 PWM 所使用的頻率。
<span class="token operator">-</span> 第 <span class="token number">6</span> 行定義每次旋轉的角度。
<span class="token operator">-</span> 第 <span class="token number">8</span> 行宣告 pigpio 控制物件。
<span class="token operator">-</span> 第 <span class="token number">10</span><span class="token operator">~</span><span class="token number">12</span> 行定義角度與工作週期的對應關係，也就是這篇文章中的公式三。不過因為 RPi<span class="token punctuation">.</span>GPIO 所使用的工作週期參數範圍為 <span class="token number">0</span> <span class="token operator">~</span> <span class="token number">100</span>，而 pigpio 的 hardware_PWM 函式所使用的工作週期參數範圍為 <span class="token number">0</span> <span class="token operator">~</span> <span class="token number">1000000</span>，所以須將原公式乘以 <span class="token number">10000</span>。
第 <span class="token number">16</span><span class="token operator">~</span><span class="token number">25</span> 行透過兩個 <span class="token keyword">for</span> 迴圈將 SG90 由 <span class="token number">0</span> 度逐次旋轉至 <span class="token number">180</span> 度，之後再逐次轉回 <span class="token number">0</span> 度。
<span class="token operator">-</span> 第 <span class="token number">26</span> 行將 SG90 軸心旋轉至 <span class="token number">90</span> 度。
<span class="token operator">-</span> 第 <span class="token number">27</span><span class="token operator">~</span><span class="token number">28</span> 行執行無任何功能的迴圈，其目的是讓 SG90 的軸心停在 <span class="token number">90</span> 度的位置。
<span class="token operator">-</span> 第 <span class="token number">32</span> 行確定程式結束後程式中所使用的腳位會回到預設狀態。

<span class="token number">11</span><span class="token punctuation">.</span> 程式完成後，輸入下列指令執行程式

    ```Shell
    python hardware_pwm_sg90<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>






</li>
</ol>
<h2 id="10-開機自動執行-shell-程式"><a href="#10-開機自動執行-shell-程式" class="headerlink" title="10. 開機自動執行 shell 程式"></a>10. 開機自動執行 <code>shell</code> 程式</h2><ol>
<li><p>目的：樹莓派開機時自動執行某些腳本，不用手動設置，減少麻煩。</p>
</li>
<li><p>思路：新建一個自動啟動 <code>pigpio</code> 服務的腳本 pigpio.sh，然後添加執行命令到 /etc/rc.local文件中</p>
</li>
<li><p>實現步驟<br>3.1. 新建一個 bash shell 腳本</p>
<pre><code> `touch /home/pi/source/pigpio.sh` </code></pre>
<p>3.2. 往 <code>pigpio.sh</code> 腳本添加如下內容</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">"/home/pi/source"</span>

<span class="token function">sudo</span> <span class="token function">service</span> pigpiod start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.3. 給予腳本 <code>pigpiod.sh</code> 許可權並執行，查看是否能正常執行</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> /home/pi/source
$ <span class="token function">chmod</span> +x pigpiod.sh
$ <span class="token function">bash</span> ./pigpiod.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>3.4. 在 <code>/etc/rc.local</code> 檔中添加執行指令碼命令</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">:</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$_IP</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
 <span class="token builtin class-name">printf</span> <span class="token string">"My IP address is %s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">$_IP</span>"</span>
<span class="token keyword">fi</span>

<span class="token function">bash</span>  ./home/pi/source/pigpiod.sh <span class="token comment">#添加這條命令，路徑是絕對路徑</span>
<span class="token builtin class-name">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
<h2 id="11-開機自動執行-python-程式"><a href="#11-開機自動執行-python-程式" class="headerlink" title="11. 開機自動執行 python 程式"></a>11. 開機自動執行 <code>python</code> 程式</h2><h3 id="步驟摘要如下"><a href="#步驟摘要如下" class="headerlink" title="步驟摘要如下 :"></a>步驟摘要如下 :</h3><ol>
<li><code>Python</code> 程式第一行要放 #!/usr/bin/python3 指定執行之解譯器版本</li>
<li>用 chmod 指令將此 Python 程式改為可執行 (+x), 例如 :<br><code>chmod +x /home/pi/test.py</code> </li>
<li>建立 bash shell 程式 <code>mypython</code>, <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/bin/bash</span>
<span class="token comment">### BEGIN INIT INFO</span>
<span class="token comment"># Provides:          mypython</span>
<span class="token comment"># Required-Start:    $syslog $network</span>
<span class="token comment"># Required-Stop:     $syslog $network</span>
<span class="token comment"># Default-Start:     2 3 4 5</span>
<span class="token comment"># Default-Stop:      0 1 6</span>
<span class="token comment"># Short-Description: starts the mypython</span>
<span class="token comment"># Description:       starts mypython using start-stop-daemon</span>
<span class="token comment">### END INIT INFO</span>

<span class="token comment"># /etc/init.d/mypython</span>
<span class="token comment"># 1.新增檔案權限：可以執行</span>
<span class="token comment">#   sudo chmod +x /etc/init.d/mypython</span>
<span class="token comment"># 2.設定開機啟動</span>
<span class="token comment">#   sudo update-rc.d mypython defaults 95</span>
<span class="token comment">#   (如果要移除開機啟動：sudo update-rc.d mypython remove)</span>
<span class="token comment">#   ( mypython 有修改的話，要執行 systemctl daemon-reload )</span>
<span class="token comment"># 3.使用指令碼啟動、停止服務</span>
<span class="token comment">#   sudo service mypython start</span>
<span class="token comment">#   sudo service mypython stop</span>

case <span class="token string">"$1"</span> <span class="token keyword">in</span>
    start<span class="token punctuation">)</span>
        echo <span class="token operator">-</span>n <span class="token string">"Starting python: "</span>
        echo <span class="token string">"---------------------------------------------------------------------------------"</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        date <span class="token operator">+</span><span class="token string">"! %Y/%m/%d %a %T : Starting python ."</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        echo start
        <span class="token comment">#cd /home/pi/inv/</span>
        <span class="token comment">#./mqtt-ledv4-test.py &gt;&gt; /var/log/inv.log &amp;</span>
        cd <span class="token operator">/</span>home<span class="token operator">/</span>pi<span class="token operator">/</span>source<span class="token operator">/</span>
        <span class="token punctuation">.</span><span class="token operator">/</span>test<span class="token punctuation">.</span>py <span class="token operator">&amp;</span>
        echo <span class="token string">"Done."</span>
        echo <span class="token string">""</span>
        date <span class="token operator">+</span><span class="token string">"! %Y/%m/%d %a %T : Finished."</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        echo <span class="token string">"---------------------------------------------------------------------------------"</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        touch <span class="token operator">/</span>var<span class="token operator">/</span>lock<span class="token operator">/</span>subsys<span class="token operator">/</span>python
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    stop<span class="token punctuation">)</span>
        echo <span class="token operator">-</span>n <span class="token string">"Shutting Down python Listeners: "</span>
        echo <span class="token string">"---------------------------------------------------------------------------------"</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        date <span class="token operator">+</span><span class="token string">"! %Y/%m/%d %a %T : Shutting Down python."</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        echo <span class="token string">"python"</span>
        <span class="token comment">#killall -9 mqtt-ledv4-test.py</span>
        killall <span class="token operator">-</span><span class="token number">9</span> test<span class="token punctuation">.</span>py
        echo <span class="token string">"Done."</span>
        rm <span class="token operator">-</span>f <span class="token operator">/</span>var<span class="token operator">/</span>lock<span class="token operator">/</span>subsys<span class="token operator">/</span>python
        echo <span class="token string">"Done."</span>
        date <span class="token operator">+</span><span class="token string">"! %Y/%m/%d %a %T : Finished."</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        echo <span class="token string">"---------------------------------------------------------------------------------"</span> <span class="token operator">&gt;&gt;</span><span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mypython
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">)</span>
        echo <span class="token string">"Usage: mypython { start | stop | restart }"</span>
        exit <span class="token number">1</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
esac
exit <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>修改其中第 38 行與第 51 行的 Python 程式檔名為自己要執行之 Python 程式檔名, 例如 test.py, 然後將此 <code>mypython</code> 程式放在 /etc/init.d/ 目錄下, 用 chmod 指令將其權限改為可執行 :<br><code>sudo chmod +x /etc/init.d/mypython</code> </li>
<li>設定 <code>mypython</code> 開機自動執行 :<br><code>sudo update-rc.d mypython defaults 95</code></li>
<li>啟動服務 :<br><code>sudo service mypython start</code></li>
<li>重開機檢查 Python 程式是否有在執行<br><code>ps -ax|grep mypython</code></li>
</ol>
<h3 id="取消自動執行程序"><a href="#取消自動執行程序" class="headerlink" title="取消自動執行程序 :"></a>取消自動執行程序 :</h3><ol>
<li>移除開機啟動設定：<br><code>sudo update-rc.d mypython remove</code></li>
<li>停止服務 :<br><code>sudo service mypython stop</code></li>
<li>刪除 mypython :<br><code>sudo rm /etc/init.d/mypython</code></li>
</ol>
<h2 id="Azure-IoT-Edge-Azure-Custom-Vision-在-RPi"><a href="#Azure-IoT-Edge-Azure-Custom-Vision-在-RPi" class="headerlink" title="Azure IoT Edge + Azure Custom Vision 在 RPi"></a>Azure IoT Edge + Azure Custom Vision 在 RPi</h2><p>Raspberry Pi Web 模擬器</p>
<h3 id="Raspberry-Pi-周邊硬體"><a href="#Raspberry-Pi-周邊硬體" class="headerlink" title="Raspberry Pi 周邊硬體"></a>Raspberry Pi 周邊硬體</h3><ol>
<li><a target="_blank" rel="noopener" href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/">Pi 3 Model B+</a></li>
<li><a target="_blank" rel="noopener" href="https://www.raspberrypi.org/products/pi-noir-camera-v2/">(NoIR) Camera V2</a></li>
<li></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://customvision.ai/">Azure Custom Vision</a></p>
<p>目前在 Azure Custom Vision 的匯出功能上，匯出到 Azure IoT Edge 的內容是以 x86 的環境來設計（可以選擇 Windows/Linux），不過還好它內容物包含了標籤 (labels.txt) 以及模型 (model.pb) 的檔案（下載的模型是 TensorFlow 的格式），所以有這兩個檔案還是可以自行撰寫 edge module。</p>
<p>所需套件</p>
<ol>
<li>Python<br><code>pillow</code>，<code>numpy</code>以及 <code>flask</code>，因為這個模組啟動的 <code>web service</code> 就是以 <code>Flask</code> 來運作的。</li>
</ol>
<p>使用 Pi Camera(而不是用 USB Cam)，若把相機位置設定成 /dev/video0，需在 <code>Raspbian</code> 上多做下列步驟:</p>
<ul>
<li>執行 <code>sudo rpi-update</code> 更新 <code>RPi</code> 的 <code>firmware</code>，重新啟動。</li>
<li>執行 <code>sudo modprobe bcm2835-v4l2</code>，注意 <code>l</code> 是小寫的 <code>L</code> 而不是數字 <code>1</code>。</li>
<li>在 <code>/etc/modules-load.d/modules.conf</code> 檔案中加入一行 <code>bcm2835-v4l2</code> ，存檔後重開機。</li>
<li>啟用 <code>Camera</code> 模組</li>
</ul>
<h2 id="微軟-Azure-上線樹莓派模擬器"><a href="#微軟-Azure-上線樹莓派模擬器" class="headerlink" title="微軟 Azure 上線樹莓派模擬器"></a>微軟 Azure 上線樹莓派模擬器</h2><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/azure/iot-hub/iot-hub-raspberry-pi-kit-node-get-started">https://docs.microsoft.com/zh-tw/azure/iot-hub/iot-hub-raspberry-pi-kit-node-get-started</a></p>
<h3 id="1-使用-Raspberry-Pi-Web-模擬器"><a href="#1-使用-Raspberry-Pi-Web-模擬器" class="headerlink" title="1. 使用 Raspberry Pi Web 模擬器"></a>1. 使用 Raspberry Pi Web 模擬器</h3><p><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602071120.png" alt="20210602071120"></p>
<p><a target="_blank" rel="noopener" href="https://azure-samples.github.io/raspberry-pi-web-simulator/#getstarted">開始 Raspberry Pi Web 模擬器</a></p>
<p>Web 模擬器中有三個區域。</p>
<ol>
<li><p>組件區域 - 預設線路是 Pi 與 BME280 感應器和 LED 連線。 此區域已在預覽版本中鎖定，所以您目前無法進行自訂。</p>
</li>
<li><p>編碼區域 - 可供您使用 Raspberry Pi 編碼的線上程式碼編輯器。 預設範例應用程式有助於從 BME280 感應器收集感應器資料，並傳送至您的 Azure IoT 中樞。 應用程式與實際 Pi 裝置完全相容。</p>
</li>
<li><p>整合式主控台視窗 - 它會顯示您的程式碼輸出。 在這個視窗頂端，有三個按鈕。</p>
<ul>
<li>執行 - 在編碼區域中執行應用程式。</li>
<li>重設 - 將編碼區域重設為預設範例應用程式。</li>
<li>摺疊/展開 - 右邊有一個可供您摺疊/展開主控台視窗的按鈕。</li>
</ul>
<blockquote>
<p>預覽版本現在提供 Raspberry Pi Web 模擬器。 我們想要在 <a target="_blank" rel="noopener" href="https://gitter.im/Microsoft/raspberry-pi-web-simulator">Gitter 聊天室</a>中傾聽您的心聲。 原始程式碼公開於 <a target="_blank" rel="noopener" href="https://github.com/Azure-Samples/raspberry-pi-web-simulator">GitHub</a>。</p>
</blockquote>
<p><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602074651.png" alt="20210602074651"></p>
</li>
</ol>
<h3 id="2-使用實體-Raspberry-Pi"><a href="#2-使用實體-Raspberry-Pi" class="headerlink" title="2. 使用實體 Raspberry Pi"></a>2. 使用實體 Raspberry Pi</h3><h4 id="2-1-創建-IoT-中心"><a href="#2-1-創建-IoT-中心" class="headerlink" title="2.1. 創建 IoT 中心"></a>2.1. 創建 IoT 中心</h4><ol>
<li><p>要把樹莓派等設備連接到 Azure 服務，首先需要連接到 Azure IoT 中樞。<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602051626.png" alt="20210602051626"></p>
</li>
<li><p>然後為該設備創建一個 Azure 設備 ID。<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602052600.png" alt="20210602052600"></p>
<p><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602052700.png" alt="20210602052700"></p>
<blockquote>
<p>IoT Hub 目前有四種不同定價，功能上並沒有差異，只是允許的每天/單位/消息數量的差別。用於測試的話，選擇免費的F1沒啥不好的。</p>
</blockquote>
</li>
<li><p>確認之後 <code>Azure</code> 就會部署新建的 <code>IoT</code> 中心，等到部署完畢，就可以查看和配置有關參數。<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602053709.png" alt="20210602053709"></p>
</li>
<li><p>創建 IoT 中心後，請在儀錶板中單擊它。 記下「主機名稱」，然後單擊「共用存取原則」<br>主機名稱: pi3B-IoT.azure-devices.net</p>
</li>
<li><p>在「共用存取原則」窗格中單擊「iothubowner」策略，然後複製並記下 IoT 中心的連接字符串。 有關詳細信息，請參閱控制對 IoT 中心的訪問。<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602063949.png" alt="20210602063949"></p>
<p>Primary connection string:<br>HostName=pi3B-IoT.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=cNVK+uDR8e3Psgh3dgM1nIDhC0Osiaji9PWmD8GuQPo=</p>
<p>Secondary connection string<br>HostName=pi3B-IoT.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=TAj8ES46YzxxU30VL9wyyzCkG6+LkX+Ja15XJO5fNJg=</p>
</li>
</ol>
<h4 id="2-2-在-IoT-中心內為設備-Pi-註冊"><a href="#2-2-在-IoT-中心內為設備-Pi-註冊" class="headerlink" title="2.2. 在 IoT 中心內為設備 Pi 註冊"></a>2.2. 在 IoT 中心內為設備 <code>Pi</code> 註冊</h4><ol>
<li><p>在 Azure Portal 中打開 IoT 中樞。</p>
</li>
<li><p>單擊「自動裝置管理」中的 IoT Edge，單擊「新增IoT Edge 裝置」將設備添加到你的 IoT 中心。 然後執行以下操作：<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602065122.png" alt="20210602065122"></p>
<p><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602065735.png" alt="20210602065735"></p>
<p>裝置識別碼：輸入新裝置的 ID。 裝置 ID 區分大小寫。 (pi3-b827eb446bbc)<br>驗證類型：選擇「對稱密鑰」。<br>自動生成密鑰：勾選此選框。<br>將這個裝置連接到 IoT 中樞：單擊「啟用」。</p>
<blockquote>
<p>重要：<br> 收集的日誌中可能會顯示裝置 ID 用於客戶支持和故障排除，因此，在為日誌命名時，請務必避免包含任何敏感信息。</p>
</blockquote>
</li>
<li><p>單擊「儲存」 。</p>
</li>
<li><p>創建裝置後，在「自動裝置管理」窗格的項目 「IoT Edge」 中打開裝置。<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602070230.png" alt="20210602070230"></p>
</li>
<li><p>記下連接字符串的主密鑰。</p>
<ul>
<li>主要連接字串<br>HostName=pi3B-IoT.azure-devices.net;DeviceId=pi3-b827eb446bbc;SharedAccessKey=FqIUSyBgBzsywYJGGhJaNCBu9RqF7bcB8i6YcMvF6wk=</li>
<li>次要連接字串<br>HostName=pi3B-IoT.azure-devices.net;DeviceId=pi3-b827eb446bbc;SharedAccessKey=QbmqytxmXl+botyyJKdVtGgfZCXFC/auLqfkgFY9cTU=</li>
</ul>
</li>
</ol>
<h4 id="2-3-設定-Raspberry-Pi"><a href="#2-3-設定-Raspberry-Pi" class="headerlink" title="2.3. 設定 Raspberry Pi"></a>2.3. 設定 Raspberry Pi</h4><ol>
<li><p>安裝 Pi 的 Raspbian 作業系統</p>
</li>
<li><p>啟用 SSH 和 I2C</p>
</li>
<li><p>將溫溼度感應器連接至 Pi<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602072141.png" alt="20210602072141"></p>
<p>感應器可以收集溫度和溼度資料。 當裝置將訊息傳送至雲端時，LED 會閃爍。</p>
<table>
<thead>
<tr>
<th>啟動(感應器和 LED)</th>
<th>結束(電路板)</th>
<th>纜線顏色</th>
</tr>
</thead>
<tbody><tr>
<td>VDD(針腳 5G)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GND(針腳 7G)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>LED VDD(針腳 18F)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>LED GND(針腳 17F)</td>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
</ol>
<ol start="4">
<li>將 Pi 連線到網路</li>
</ol>
<h4 id="2-4-在-Pi-上執行範例應用程式，將感應器資料傳送至-IoT-中樞"><a href="#2-4-在-Pi-上執行範例應用程式，將感應器資料傳送至-IoT-中樞" class="headerlink" title="2.4. 在 Pi 上執行範例應用程式，將感應器資料傳送至 IoT 中樞"></a>2.4. 在 Pi 上執行範例應用程式，將感應器資料傳送至 IoT 中樞</h4><p>透過 micro USB 纜線和電源供應器來開啟 Pi。 使用乙太網路纜線將 Pi 連接到有線網路，或遵循來自 Raspberry Pi Foundation 的指示，將 Pi 連接到無線網路。 在 Pi 成功連線到網路之後，您需要記下 Pi 的 IP 位址。</p>
<blockquote>
<p>請確定 Pi 是連接到與您電腦相同的網路。 例如，如果您的電腦連線到無線網路，而 Pi 連線到有線網路，您可能不會在 devdisco 輸出中看到 IP 位址。</p>
</blockquote>
<h3 id="在-Pi-Web-模擬器上運行示例應用程式"><a href="#在-Pi-Web-模擬器上運行示例應用程式" class="headerlink" title="在 Pi Web 模擬器上運行示例應用程式"></a>在 Pi Web 模擬器上運行示例應用程式</h3><ol>
<li><p>製範例應用程式並安裝必要條件套件</p>
<ul>
<li><p>請先檢查您的 Node.js 版本。<br><code>node  -v</code></p>
<blockquote>
<p>如果版本低於2.x，或您的 Pi 上沒有 Node.js，請安裝最新版本。</p>
</blockquote>
</li>
<li><p>node<br><code>curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash</code><br><code>sudo apt-get -y install nodejs</code></p>
</li>
<li><p>複製範例應用程式<br><code>git clone https://github.com/Azure-Samples/azure-iot-samples-node.git</code></p>
</li>
<li><p>安裝該範例的所有套件。 此安裝包含 Azure IoT 裝置 SDK、BME280 感應器程式庫及 Wiring Pi 程式庫</p>
<p><code>cd azure-iot-samples-node/iot-hub/Tutorials/RaspberryPiApp</code><br><code>npm install</code> </p>
</li>
</ul>
</li>
<li><p>設定範例應用程式</p>
<ul>
<li><p>執行下列命令以開啟組態檔：<br><code>nano config.json</code></p>
<p>此檔案中有兩個您可以設定的項目。 第一個是 interval，這定義傳送至雲端之訊息間的時間間隔 (以毫秒為單位)。 第二個是 simulatedData，這是指出是否要使用模擬感應器資料的布林值。</p>
<blockquote>
<p>如果 <strong>沒有感應器</strong>，請將 simulatedData 值設定為 true，使範例應用程式建立和使用模擬感應器資料。</p>
</blockquote>
</li>
<li><p>輸入 Control-O &gt; 按 Enter 鍵 &gt; Control-X 來儲存並結束。  </p>
</li>
</ul>
</li>
<li><p>執行範例應用程式<br><code>sudo node index.js '&lt;YOUR AZURE IOT HUB DEVICE CONNECTION STRING&gt;'</code></p>
<blockquote>
<p>確定複製裝置連接字串，並貼到單引號中。</p>
</blockquote>
<p>您應該會看見下列輸出，顯示傳送至 IoT 中樞的感應器資料和訊息。<br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602074015.png" alt="20210602074015"></p>
</li>
</ol>
<ol start="4">
<li><p>讀取中樞所接收的訊息<br>若要從您的裝置監視 IoT 中樞所收到的訊息，其中一種方式是<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/azure/iot-hub/iot-hub-vscode-iot-toolkit-cloud-device-messaging">使用 Visual Studio Code 的 Azure IoT Tools。 若要深入瞭解，請參閱 使用 Azure IoT Tools Visual Studio Code，以在您的裝置與 IoT 中樞之間傳送和接收訊息</a>。</p>
<p>如需更多處理裝置所傳送資料的方式，請繼續下一節。</p>
</li>
</ol>
<p>微軟 <code>Azure</code> 上線樹莓派模擬器</p>
<p><a target="_blank" rel="noopener" href="https://zh.codeprj.com/blog/7a66c91.html">https://zh.codeprj.com/blog/7a66c91.html</a></p>
<ol>
<li><p>更新系統<br>sudo apt update &amp;&amp; sudo apt full-upgrade -y</p>
</li>
<li><p>檢查 python 與 pip 版本<br>python –version &amp;&amp; pip –version</p>
<blockquote>
<p>若無 python 或 pip 可以使用一下方式安裝<br> sudo apt install python-pip -y</p>
</blockquote>
<p>更新工具  </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">sudo pip install <span class="token operator">-</span><span class="token operator">-</span>upgrade setuptools pip
sudo apt install python2<span class="token punctuation">.</span><span class="token number">7</span><span class="token operator">-</span>dev libffi<span class="token operator">-</span>dev libssl<span class="token operator">-</span>dev <span class="token operator">-</span>y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>安裝 Docker<br><code>curl -sSL https://get.docker.com | sudo -E sh</code></p>
<p>安裝完成之后，為當前用戶（pi）添加運行 Docker 的權限，<br><code>sudo usermod -aG docker pi</code></p>
<p>重啟樹莓派<br><code>sudo reboot</code></p>
<p>測試 <code>Docker</code> 運行狀態<br><code>docker run hello-world</code><br><img src="/medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/allen-5183/blog.allen5183.synology.me/images/20210602061722.png" alt="20210602061722"></p>
<p>現在，我們需要通過 Docker 將 <code>IoTedge Agent</code> 和 <code>IoTedge Hub</code> 這兩個模塊 <code>Pull</code> 到本地，分別運行：</p>
<p><code>docker pull microsoft/azureiotedge-agent:1.0-preview</code><br><code>docker pull microsoft/azureiotedge-hub:1.0-preview</code></p>
</li>
<li><p>IoT Edge Device的創建<br>這部分可以參考《Azure IoT Edge on Windows 10 IoT Core》一文中的第4部分，在IoT Edge中創建一個名為Raspberry的IoT Edge Device，並獲得其連接字符串Connection String。</p>
</li>
<li><p>IoT Edge Runtime的部署與配置<br>首先，使用如下命令安裝IoT Edge control腳本：</p>
<p>sudo pip install -U azure-iot-edge-runtime-ctl</p>
<p>之后，通過執行如下指令來配置IoT Edge Runtime：</p>
<p>iotedgectl setup –connection-string “{device connection string}” –auto-cert-gen-force-no-passwords</p>
<p>其中的”{device connection string}”由上面第4步中保存的Connection String來代替。</p>
</li>
</ol>
<h2 id="人臉辨識"><a href="#人臉辨識" class="headerlink" title="人臉辨識"></a>人臉辨識</h2><p><a target="_blank" rel="noopener" href="https://ericsk.medium.com/azure-iot-edge-azure-custom-vision-raspberry-pi-3-%E5%AF%A6%E7%8F%BE%E9%82%8A%E7%B7%A3%E9%81%8B%E7%AE%97-edge-computing-%E4%B8%8A%E7%9A%84%E9%9B%A2%E7%B7%9A%E9%9B%BB%E8%85%A6%E8%A6%96%E8%A6%BA%E6%87%89%E7%94%A8-94d6bde2b244">https://ericsk.medium.com/azure-iot-edge-azure-custom-vision-raspberry-pi-3-%E5%AF%A6%E7%8F%BE%E9%82%8A%E7%B7%A3%E9%81%8B%E7%AE%97-edge-computing-%E4%B8%8A%E7%9A%84%E9%9B%A2%E7%B7%9A%E9%9B%BB%E8%85%A6%E8%A6%96%E8%A6%BA%E6%87%89%E7%94%A8-94d6bde2b244</a></p>
<ol>
<li><p>流程</p>
<p>抓取人臉        使用 opencv 庫內建 face track 抓取臉部特徵來達成辨識臉部的目的，並標示區域</p>
<pre><code>            由於電腦使用普通色彩去判斷人臉會花較多資源且會使訓練過程變得很複雜，所以要先將彩色圖片轉為灰度圖，，這可使圖片的對比度增高、去除雜訊與降低圖片資料。

            獲取圖片 -&gt; 圖片轉灰白 -&gt; 進行面部追蹤 -&gt; 抓取面部圖片 -&gt; 圖片上傳至雲端 -&gt; Azure 進行辨識</code></pre>
</li>
</ol>
<p>#擷取攝影機畫面<br>frame = ipcam.getframe()<br>output = ipcam.getframe()<br>#ret, frame = video_capture.read()<br>#ret, output = video_capture.read()<br>#轉灰階<br>try:<br>   gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br>   faced = faceCascade.detectMultiScale(<br>       gray,<br>       scaleFactor=1.1,<br>       minNeighbors=5,<br>       minSize=(30, 30)<br>   )<br>except:<br>    print(“轉換錯誤，切換模式”)<br>    faces = faceCascade.detectMultiScale(<br>       frame,<br>       scalefactor=1.1,<br>       minNeighbors=5,<br>       minSize=(30, 30)<br>    )</p>
<ol start="2">
<li><p>上傳人臉        使用 imggur 服務上傳人臉</p>
</li>
<li><p>辨識表情        上傳至 Azure 後，獲取臉部辨識報告</p>
</li>
<li><p>顯示結果        </p>
</li>
</ol>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">allen tai</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章連結:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://blog.allen5183.synology.me/wiot/20210329-wiot/">http://blog.allen5183.synology.me/wiot/20210329-wiot/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版權聲明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別聲明外，均採用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    授權合約。轉載請注明來源
                    <a href="/about" target="_blank">allen tai</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>複製成功，請遵循本文的轉載規則</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/iot/">
                                    <span class="chip bg-color">iot</span>
                                </a>
                            
                                <a href="/tags/wiot/">
                                    <span class="chip bg-color">wiot</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,wechat,linkedin" data-wechat-qrcode-helper="<p>微信掃一掃即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>評論</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'e484b237dd5bd59118c0',
        clientSecret: '7071e58c699bdbdce68a1d36b72b4184f24e98b1',
        repo: 'hexo-matery',
        owner: 'allen-5183',
        admin: ["allen-5183"],
        id: '2021-03-28T16-53-45',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

        

     <article id="prenext-posts" class="prev-next articles">
         <div class="row article-row">
             
             <div class="article col s12 m6" data-aos="fade-up">
                 <div class="article-badge left-badge text-color">
                     <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
                 <div class="card">
                     <a href="/php/20210408-php-basic/">
                         <div class="card-image">
                             
                             
                             <img src="/medias/loading.gif" data-original="/medias/featureimages/3.jpg" class="responsive-img" alt="PHP 基礎篇">
                             
                             <span class="card-title">PHP 基礎篇</span>
                         </div>
                     </a>
                     <div class="card-content article-content">
                         <div class="summary block-with-text">
                             
                                 PHP 基礎1. php 簡介  PHP，即 PHP: Hypertext Preprocessor，是一種被廣泛應用的開源通用指令碼語言，尤其適用於 Web 開發並可嵌入 HTML 中。  它的語法利用了 C、Java 和 Perl，易於
                             
                         </div>
                         <div class="publish-info">
                             <span class="publish-date">
                                 <i class="far fa-clock fa-fw icon-date"></i>2021-04-07
                             </span>
                             <span class="publish-author">
                                 
                                 <i class="fas fa-bookmark fa-fw icon-category"></i>
                                 
                                 <a href="/categories/php/" class="post-category">
                                         php
                                     </a>
                                 
                                 
                             </span>
                         </div>
                     </div>
                     
                     <div class="card-action article-tags">
                         
                         <a href="/tags/php/">
                             <span class="chip bg-color">php</span>
                         </a>
                        
                     </div>
                     
                 </div>
             </div>
             
             
             <div class="article col s12 m6" data-aos="fade-up">
                 <div class="article-badge right-badge text-color">
                     下一篇&nbsp;<i class="fas fa-chevron-right"></i>
                 </div>
                 <div class="card">
                     <a href="/iot/20210207-pi3/">
                         <div class="card-image">
                             
                             
                        <img src="/medias/loading.gif" data-original="/medias/featureimages/2.jpg" class="responsive-img" alt="樹莓派製作無線路由器">
                        
                        <span class="card-title">樹莓派製作無線路由器</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            樹莓派製作無線路由器1. 軟體安裝和網絡配置首先安裝兩個製作無線路由器必需的軟體：

hostapd： 該軟體能使無線網卡工作在軟 AP(Access Point)模式，作為無線路由器使用，提供其他無線網卡接入上網；
wpa_supplic
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-02-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/iot/" class="post-category">
                                    iot
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/iot/">
                        <span class="chip bg-color">iot</span>
                    </a>
                    
                    <a href="/tags/wiot/">
                        <span class="chip bg-color">wiot</span>
                    </a>
                    
                    <a href="/tags/pi/">
                        <span class="chip bg-color">pi</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
      </div>
    </article>

</div>



<!-- 代碼塊功能依賴 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代碼語言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代碼塊複製 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代碼塊收縮 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代碼塊折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目錄</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 懸浮按鈕. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修復文章卡片 div 的寬度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切換TOC目錄展開收縮的相關操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='false'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">

            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="/about" target="_blank">Allen Tai</a>
            <br>

            

            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;總訪問量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;總訪問人數:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>

        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/allen-5183" class="tooltipped" target="_blank" data-tooltip="allen's GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:allen5183@gmail.com" class="tooltipped" target="_blank" data-tooltip="郵件聯繫我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/allen5183" class="tooltipped" target="_blank" data-tooltip="關注我的 
Facebook: https://www.facebook.com/allen5183" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>




    <a href="" class="tooltipped" target="_blank"
data-tooltip="關注我的 Twitter: https://twitter.com/allen5183" data-position="top" data-delay="50">                                                                                                               
<i class="fab fa-twitter"></i>
    </a>



                                                                                                                                                                                   
<a href="https://plus.google.com/allen5183" class="tooltipped" target="_blank"                                                                                                                                    
data-tooltip="關注我的 Google: https://plus.google.com/allen5183" data-position="top" data-delay="50">                                                                                                              
<i class="fab fa-google-plus-g"></i>                                                                                                                                                                                          
</a>                                                                                                                                                                                                            
   





<!--

    <a href="https://twitter.com/allen5183" class="tooltipped" target="_blank" data-tooltip="關注我的Twitter: https://twitter.com/allen5183" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>









-->


    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 訂閱" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>

<!-- 燈籠左 -->
<!-- <div class="deng-box"> -->
<!--   <div class="deng"> -->
<!--     <div class="xian"></div> -->
<!--       <div class="deng-a"> -->
<!--        <div class="deng-b"><div class="deng-t">雙十</div></div> -->
<!--        </div>   -->
<!--        <div class="shui shui-a">  -->
<!--          <div class="shui-c"></div> -->
<!--             <div class="shui-b"></div> -->
<!--        </div> -->
<!--    </div> -->
<!-- </div> -->



<!-- 燈籠右 -->
<!-- <div class="deng-box1"> -->
<!--    <div class="deng"> -->
<!--        <div class="xian"></div> -->
<!--        <div class="deng-a"> -->
<!--            <div class="deng-b"><div class="deng-t">同慶</div></div>  -->
<!--        </div>  -->
<!--        <div class="shui shui-a"> -->
<!--            <div class="shui-c"></div>  -->
<!--            <div class="shui-b"></div>  -->
<!--        </div> -->
<!--    </div>  -->
<!-- </div>  -->

</footer>

<div class="progress-bar"></div>

<!-- 閒聊麼  -->
<script>
    var xlm_wid='16495';
    var xlm_url='https://www.xianliao.me/';
</script>
<script type='text/javascript' charset='UTF-8' src='https://www.xianliao.me/embed.js'></script>




    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="請輸入搜索的關鍵字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到頂部按鈕 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    
    <script>
        (function (i, s, o, g, r, a, m) {
            i["DaoVoiceObject"] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            a.charset = "utf-8";
            m.parentNode.insertBefore(a, m)
        })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') +
            "//widget.daovoice.io/widget/6984b559.js", "daovoice")
        daovoice('init', {
            app_id: "22dc2875"
        });
        daovoice('update');
    </script>
    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/nito.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true,"scale":0.5},"react":{"opacity":0.7},"log":false});</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>

</html>
